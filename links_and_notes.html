<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upravitelj Linkovima i Bilješkama</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background-color: #f4f4f4;
            color: #333;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding-top: 60px; /* Dodajte padding da sadržaj ne bude ispod navbara */
        }

        /* --- NAVBAR STILOVI --- */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #0056b3;
            padding: 10px 20px;
            color: white;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            box-sizing: border-box;
            z-index: 1000; /* Osigurava da je navbar iznad ostalog sadržaja */
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .navbar-left .app-title {
            font-size: 1.3em;
            font-weight: bold;
            color: white; /* Da bi naslov bio bijele boje */
        }
        .navbar-right {
            display: flex;
            align-items: center;
        }
        .navbar-right button {
            color: white;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 5px;
            transition: background-color 0.3s ease;
            font-size: 1.1em;
            cursor: pointer;
            border: none;
            background: none;
        }
        .navbar-right button:hover {
            background-color: #004085;
        }
        .navbar-right button:not(:last-child) {
            margin-right: 10px; /* Razmak između gumba */
        }

        /* --- MODAL STILOVI --- */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 2000; /* Higher than navbar */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.6); /* Black w/ opacity */
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            max-width: 800px;
            width: 90%;
            position: relative;
            max-height: 90vh; /* Max height to allow scrolling */
            overflow-y: auto; /* Enable vertical scrolling */
            -webkit-animation-name: animatetop;
            -webkit-animation-duration: 0.4s;
            animation-name: animatetop;
            animation-duration: 0.4s
        }

        /* Add Animation */
        @-webkit-keyframes animatetop {
            from {top: -300px; opacity: 0}
            to {top: 0; opacity: 1}
        }
        @keyframes animatetop {
            from {top: -300px; opacity: 0}
            to {top: 0; opacity: 1}
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            top: 10px;
            right: 20px;
            cursor: pointer;
        }
        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
        }
        .modal-content h1, .modal-content h2, .modal-content h3 {
            color: #0056b3;
            margin-top: 15px;
        }
        .modal-content h1 { text-align: center; margin-bottom: 25px;}
        .modal-content h2 { border-bottom: 1px solid #eee; padding-bottom: 5px; margin-bottom: 15px;}
        .modal-content p, .modal-content ul, .modal-content ol {
            margin-bottom: 10px;
        }
        .modal-content hr {
            border: 0;
            height: 1px;
            background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));
            margin: 25px 0;
        }

        /* --- POSTOJEĆI STILOVI --- */
        .main-wrapper {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            width: 100%;
            max-width: 1200px;
            margin: 20px auto;
            box-sizing: border-box;
            padding: 0 20px;
        }
        .container {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            box-sizing: border-box;
            flex: 1;
            min-width: 300px;
        }
        h1, h2 {
            color: #0056b3;
            text-align: center;
            margin-bottom: 20px;
        }
        input[type="text"], input[type="url"], textarea {
            width: calc(100% - 22px);
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }
        .action-buttons .export-btn {
            background-color: #28a745;
        }
        .action-buttons .export-btn:hover {
            background-color: #218838;
        }
        .action-buttons input[type="file"] {
            display: none;
        }
        .action-buttons label.button {
            background-color: #ffc107;
            color: #333;
            cursor: pointer;
            padding: 10px 15px;
            border-radius: 4px;
            display: inline-block;
            font-size: 16px;
            text-align: center;
            box-sizing: border-box;
            height: 42px;
            line-height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .action-buttons label.button:hover {
            background-color: #e0a800;
        }
        #editModeBtnLinks, #editModeBtnNotes {
            background-color: #6c757d;
        }
        #editModeBtnLinks.active, #editModeBtnNotes.active {
            background-color: #dc3545;
        }
        #editModeBtnLinks:hover, #editModeBtnNotes:hover {
            background-color: #5a6268;
        }
        #editModeBtnLinks.active:hover, #editModeBtnNotes.active:hover {
            background-color: #c82333;
        }
        
        /* Novi stil za "Obriši sve" gumbe */
        .action-buttons .delete-all-btn {
            background-color: #dc3545; /* Crvena boja */
        }
        .action-buttons .delete-all-btn:hover {
            background-color: #c82333; /* Tamnija crvena na hover */
        }

        /* --- STILOVI ZA LINKOVE --- */
        .link-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: flex-start;
            padding: 10px 0;
            min-height: 150px; /* Dodano za bolje drag/drop iskustvo kad je prazno */
        }
        .link-item {
            background-color: #e9e9e9;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            flex: 1 1 calc(50% - 30px);
            min-width: 250px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: relative;
            overflow: hidden;
            box-sizing: border-box;
            cursor: grab; /* Dodan kursor za drag */
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
        }
        /* Stil za element koji se povlači */
        .link-item.dragging, .note-item.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }
        /* Stil za drop zonu */
        .link-item.drag-over, .note-item.drag-over {
            background-color: #d1ecf1; /* Svijetlo plava */
            border: 2px dashed #007bff;
        }

        .link-item a {
            text-decoration: none;
            color: #007bff;
            font-weight: bold;
            font-size: 1.1em;
            display: block;
            margin-bottom: 5px;
            word-break: break-word;
        }
        .link-item a:hover {
            text-decoration: underline;
        }
        .link-item .url-display {
            font-size: 0.9em;
            color: #555;
            word-break: break-word;
            margin-bottom: 10px;
        }
        .link-item .delete-btn, .link-item .edit-btn {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            position: absolute;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease-in-out;
            z-index: 10;
        }
        .link-item .edit-btn {
            background-color: #007bff;
        }
        .link-item .delete-btn { top: 10px; right: 10px; }
        .link-item .edit-btn { top: 10px; right: 80px; }
        .link-item.editing .delete-btn,
        .link-item.editing .edit-btn {
            opacity: 1;
            pointer-events: auto;
        }
        .link-item.editing-single .link-title-display {
            display: none;
        }
        .link-item .edit-title-input {
            width: calc(100% - 20px);
            padding: 5px;
            margin-bottom: 5px;
            border: 1px solid #007bff;
            border-radius: 4px;
            font-size: 1.1em;
            display: none;
        }
        .link-item.editing-single .edit-title-input {
            display: block;
        }
        .link-item .edit-buttons {
            display: none;
            justify-content: flex-end;
            margin-top: 10px;
        }
        .link-item.editing-single .edit-buttons {
            display: flex;
        }
        .link-item .edit-buttons button {
            position: static;
            opacity: 1;
            pointer-events: auto;
            margin-left: 5px;
            padding: 6px 12px;
            font-size: 0.9em;
        }
        .link-item .edit-buttons .save-btn { background-color: #28a745; }
        .link-item .edit-buttons .cancel-btn { background-color: #6c757d; }


        /* --- STILOVI ZA BILJEŠKE --- */
        .notes-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: flex-start;
            padding: 10px 0;
            min-height: 150px; /* Dodano za bolje drag/drop iskustvo kad je prazno */
        }
        .note-item {
            background-color: #fffacd;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 3px 3px 5px rgba(0, 0, 0, 0.2);
            transform: rotate(calc(var(--rotation) * 1deg));
            margin-bottom: 15px;
            flex: 1 1 calc(50% - 15px);
            min-width: 250px;
            display: flex;
            flex-direction: column;
            position: relative;
            box-sizing: border-box;
            word-wrap: break-word;
            max-height: 500px;
            transition: max-height 0.3s ease-out, background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
            cursor: grab; /* Dodan kursor za drag */
        }
        .note-item.closed {
            max-height: 70px;
            padding-bottom: 15px;
        }
        .note-item.closed .note-content {
            display: none;
        }
        .note-item.closed .toggle-note-btn {
            background-color: #007bff;
        }
        .note-item.closed .toggle-note-btn::before {
            content: 'Otvori';
        }
        .note-item:not(.closed) .toggle-note-btn::before {
            content: 'Zatvori';
        }
        .note-item:nth-child(even) { --rotation: 2; }
        .note-item:nth-child(odd) { --rotation: -1; }
        .note-item:nth-child(3n) { --rotation: 3; }
        .note-item:nth-child(4n) { --rotation: -2; }
        .note-item:nth-child(5n) { --rotation: 1; }
        .note-item.editing-single-note { transform: rotate(0deg) !important; }

        .note-item .note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .note-item .note-title-display {
            font-weight: bold;
            font-size: 1.1em;
            color: #0056b3;
            margin: 0;
            flex-grow: 1;
            word-break: break-word;
        }
        .note-item .toggle-note-btn {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
            margin-left: 10px;
            flex-shrink: 0;
        }
        .note-item .toggle-note-btn:hover {
            opacity: 0.8;
        }
        .note-item .note-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        .note-item .note-text-display {
            font-size: 1em;
            line-height: 1.4;
            margin-bottom: 10px;
            white-space: pre-wrap;
        }
        .note-item .edit-title-input-note, .note-item .edit-note-textarea {
            width: calc(100% - 20px);
            padding: 5px;
            margin-bottom: 5px;
            border: 1px solid #ffc107;
            border-radius: 4px;
            font-size: 1em;
            display: none;
        }
        .note-item .edit-note-textarea {
            min-height: 80px;
        }
        .note-item.editing-single-note .note-title-display,
        .note-item.editing-single-note .note-text-display {
            display: none;
        }
        .note-item.editing-single-note .edit-title-input-note,
        .note-item.editing-single-note .edit-note-textarea {
            display: block;
        }
        .note-item .delete-note-btn, .note-item .edit-note-btn {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            position: absolute;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease-in-out;
            z-index: 10;
        }
        .note-item .edit-note-btn {
            background-color: #007bff;
        }
        .note-item .delete-note-btn { top: 10px; right: 10px; }
        .note-item .edit-note-btn { top: 10px; right: 80px; }
        .note-item.editing-notes .delete-note-btn,
        .note-item.editing-notes .edit-note-btn {
            opacity: 1;
            pointer-events: auto;
        }
        .note-item.editing-notes .toggle-note-btn {
            display: none;
        }
        .note-item .note-edit-buttons {
            display: none;
            justify-content: flex-end;
            margin-top: 10px;
        }
        .note-item.editing-single-note .note-edit-buttons {
            display: flex;
        }
        .note-item .note-edit-buttons button {
            position: static;
            opacity: 1;
            pointer-events: auto;
            margin-left: 5px;
            padding: 6px 12px;
            font-size: 0.9em;
        }
        .note-item .note-edit-buttons .save-note-btn { background-color: #28a745; }
        .note-item .note-edit-buttons .cancel-note-btn { background-color: #6c757d; }

        #noLinksMessage, #noNotesMessage {
            text-align: center;
            padding: 20px;
            color: #666;
            font-style: italic;
        }
        hr {
            border: 0;
            height: 1px;
            background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));
            margin: 20px 0;
        }
        .container hr {
            margin: 15px 0;
        }

        /* --- STILOVI ZA PAGINACIJU --- */
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            gap: 5px;
            flex-wrap: wrap;
        }
        .pagination button {
            background-color: #f0f0f0;
            color: #333;
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            min-width: 40px;
            text-align: center;
        }
        .pagination button:hover {
            background-color: #e2e2e2;
        }
        .pagination button.active {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }
        .pagination button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            color: #666;
        }

        /* --- STILOVI ZA TOOLTIP (Važna napomena) --- */
        .info-tooltip-container {
            position: relative;
            display: inline-block;
            margin-left: 10px; /* Razmak od gumba "Autor" */
            cursor: pointer;
            z-index: 1050; /* Veći z-index da bude iznad svega */
        }
        .info-tooltip-container .info-icon {
            background-color: #ffc107; /* Žuta pozadina */
            color: #333; /* Tamni tekst */
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 1.1em;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: background-color 0.2s ease;
        }
        .info-tooltip-container .info-icon:hover {
            background-color: #e0a800;
        }
        .info-tooltip-container .tooltip-content {
            visibility: hidden;
            opacity: 0;
            width: 300px; /* Širina oblačića */
            background-color: #fefefe;
            color: #333;
            text-align: left;
            border-radius: 8px;
            padding: 15px;
            position: absolute;
            z-index: 1;
            top: 120%; /* Pozicija ispod ikone */
            right: 0; /* Poravnaj desno s ikonom */
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: opacity 0.3s, visibility 0.3s;
            font-size: 0.9em;
            line-height: 1.5;
            border: 1px solid #ddd;
        }
        /* Strelica na vrhu tooltipa, opciono */
        .info-tooltip-container .tooltip-content::after {
            content: "";
            position: absolute;
            bottom: 100%;
            right: 15px; /* Poravnaj strelicu s desne strane */
            border-width: 8px;
            border-style: solid;
            border-color: transparent transparent #fefefe transparent;
        }
        .info-tooltip-container:hover .tooltip-content {
            visibility: visible;
            opacity: 1;
        }
        .info-tooltip-container .tooltip-content h4 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #0056b3;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        .info-tooltip-container .tooltip-content ul {
            padding-left: 20px;
            margin-top: 5px;
        }
        .info-tooltip-container .tooltip-content li {
            margin-bottom: 5px;
        }

        /* Responzivnost */
        @media (max-width: 992px) {
            .main-wrapper {
                flex-direction: column;
                padding: 0 10px;
            }
            .container {
                flex: none;
                width: 100%;
            }
            .link-item, .note-item {
                flex: 1 1 calc(33.333% - 30px);
            }
            .navbar {
                flex-direction: column;
                align-items: flex-start;
                padding: 10px;
            }
            .navbar-right {
                margin-top: 10px;
                width: 100%;
                justify-content: center;
            }
            .navbar-right button {
                flex-grow: 1;
                margin: 0 5px;
            }
            body {
                padding-top: 100px; /* Povećaj padding ako se navbar preklopi na 2 reda */
            }
        }
        @media (max-width: 768px) {
            .link-item, .note-item {
                flex: 1 1 calc(50% - 30px);
            }
        }
        @media (max-width: 480px) {
            .link-item, .note-item {
                flex: 1 1 100%;
            }
            button, .action-buttons label.button {
                width: 100%;
                margin-right: 0;
                margin-bottom: 10px;
            }
            .action-buttons {
                flex-direction: column;
                align-items: stretch;
            }
            .navbar-right button {
                margin: 0 0 10px 0; /* Stack buttons vertically */
            }
            .navbar-right {
                flex-direction: column;
                align-items: stretch;
            }
            .info-tooltip-container {
                align-self: flex-end; /* Postavi tooltip na desni kraj */
                margin-top: 10px;
                margin-left: 0;
            }
            .info-tooltip-container .tooltip-content {
                width: 90vw; /* Povećaj širinu na manjim ekranima */
                right: 0;
                left: unset; /* Resetiraj lijevi položaj */
                transform: translateX(0%); /* Resetiraj transformaciju */
            }
            .info-tooltip-container .tooltip-content::after {
                right: 15px; /* Održavaj strelicu desno */
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-left">
            <span class="app-title">Linkovi i Bilješke</span>
        </div>
        <div class="navbar-right">
            <button onclick="openModal('helpModal')">Pomoć</button>
            <button onclick="openModal('aboutModal')">O aplikaciji</button>
            <button onclick="openModal('authorModal')">Autor</button>
            <div class="info-tooltip-container">
                <span class="info-icon">i</span>
                <div class="tooltip-content">
                    <h4>Važna napomena o podacima:</h4>
                    <p>Ova aplikacija pohranjuje sve tvoje podatke (linkove i bilješke) isključivo u **lokalnu memoriju (Local Storage)** web preglednika koji koristiš.</p>
                    <p>To znači da:</p>
                    <ul>
                        <li>Podaci su spremljeni samo u pregledniku na uređaju koji trenutno koristiš.</li>
                        <li>Ako istu HTML datoteku otvoriš u **drugom pregledniku** (npr. Chrome umjesto Firefoxa), to će biti **potpuno nova, prazna instanca** aplikacije. Podaci se neće automatski prenijeti između preglednika.</li>
                        <li>Slično, ako datoteku otvoriš na **drugom uređaju**, također ćeš početi s praznom aplikacijom.</li>
                        <li>Za prijenos ili sigurnosnu kopiju podataka između preglednika ili uređaja, **obavezno koristi funkcije "Izvezi linkove (.json)" i "Izvezi bilješke (.json)"** te ih potom "Uvezi" na drugom mjestu.</li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <div class="main-wrapper">
        <div class="container" id="linksSection">
            <h1>Upravitelj Linkovima</h1>

            <div class="add-link-section">
                <h2>Dodaj novi link</h2>
                <input type="text" id="linkTitle" placeholder="Naslov linka" required>
                <input type="url" id="linkUrl" placeholder="URL linka (npr. https://www.primjer.com)" required>
                <button onclick="addLink()">Dodaj Link</button>
            </div>

            <hr>

            <div class="action-buttons">
                <button id="editModeBtnLinks" onclick="toggleEditModeLinks()">Uredi linkove</button>
                <button class="export-btn" onclick="exportLinks()">Izvezi linkove (.json)</button>
                <input type="file" id="importFileLinks" accept=".json" onchange="importLinks(event)">
                <label for="importFileLinks" class="button">Uvezi linkove (.json)</label>
                <button class="delete-all-btn" onclick="clearAllLinks()">Obriši sve linkove</button>
            </div>

            <hr>

            <div class="link-list-section">
                <h2>Spremljeni linkovi</h2>
                <div id="linkGrid" class="link-grid">
                    </div>
                <p id="noLinksMessage" style="display: none;">Još nema spremljenih linkova.</p>
                <div id="paginationLinks" class="pagination">
                    </div>
            </div>
        </div>

        <div class="container" id="notesSection">
            <h1>Moje Bilješke</h1>

            <div class="add-note-section">
                <h2>Dodaj novu bilješku</h2>
                <input type="text" id="noteTitle" placeholder="Naslov bilješke (opcionalno)">
                <textarea id="noteText" placeholder="Unesite tekst bilješke ovdje..." rows="4" required></textarea>
                <button onclick="addNote()">Dodaj Bilješku</button>
            </div>

            <hr>

            <div class="action-buttons">
                <button id="editModeBtnNotes" onclick="toggleEditModeNotes()">Uredi bilješke</button>
                <button class="export-btn" onclick="exportNotes()">Izvezi bilješke (.json)</button>
                <input type="file" id="importFileNotes" accept=".json" onchange="importNotes(event)">
                <label for="importFileNotes" class="button">Uvezi bilješke (.json)</label>
                <button class="delete-all-btn" onclick="clearAllNotes()">Obriši sve bilješke</button>
            </div>

            <hr>

            <div class="note-list-section">
                <h2>Spremljene bilješke</h2>
                <div id="notesGrid" class="notes-grid">
                    </div>
                <p id="noNotesMessage" style="display: none;">Još nema spremljenih bilješki.</p>
                <div id="paginationNotes" class="pagination">
                    </div>
            </div>
        </div>
    </div>

    <div id="helpModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('helpModal')">&times;</span>
            <h1>Upute za korištenje aplikacije Upravitelj Linkovima i Bilješkama</h1>
            <p>Dobrodošli u tvoju osobnu aplikaciju za organizaciju linkova i bilješki! Aplikacija ti omogućuje da jednostavno spremaš, pregledavaš, uređuješ i brišeš web linkove i osobne bilješke. Također, možeš ih izvesti i uvesti za sigurnosnu kopiju ili prijenos.</p>
            <p>Aplikacija se sastoji od dvije glavne sekcije: <strong>Upravitelj Linkovima</strong> (lijeva strana) i <strong>Moje Bilješke</strong> (desna strana).</p>

            <hr>

            <h2>Upravitelj Linkovima</h2>
            <p>Ova sekcija ti pomaže da organiziraš svoje omiljene web stranice.</p>

            <h3>1. Dodaj novi link:</h3>
            <ul>
                <li>U polje <strong>"Naslov linka"</strong> unesi naziv koji želiš dati linku (npr. "Moj omiljeni blog").</li>
                <li>U polje <strong>"URL linka"</strong> unesi punu web adresu (npr. <code>https://www.primjer.com</code>). Obavezno mora početi s <code>http://</code> ili <code>https://</code>.</li>
                <li>Klikni na gumb <strong>"Dodaj Link"</strong>. Link će se pojaviti na listi spremljenih linkova.</li>
            </ul>

            <h3>2. Spremljeni linkovi:</h3>
            <ul>
                <li>Svi tvoji spremljeni linkovi prikazani su u mreži. Klikom na <strong>naslov linka</strong> otvaraš link u novom tabu preglednika.</li>
                <li><strong>Paginacija:</strong> Ako imaš mnogo linkova, oni će biti podijeljeni na stranice (<strong>10 linkova po stranici</strong>). Koristi gumbe "Prethodna", "Sljedeća" i numerirane gumbe na dnu liste za navigaciju kroz stranice.</li>
                <li><strong>Premještanje (Drag & Drop):</strong> Linkove možeš preuređivati unutar trenutne stranice povlačenjem i ispuštanjem. Samo klikni i drži link, povuci ga na željeno mjesto i pusti. (Ovo ne radi dok je aktiviran "Način uređivanja").</li>
            </ul>

            <h3>3. Uređivanje i brisanje linkova (način uređivanja):</h3>
            <ol>
                <li>Klikni na gumb <strong>"Uredi linkove"</strong>. Gumb će postati crven, a na svakom linku pojavit će se gumbi "Obriši" i "Uredi".</li>
                <li><strong>Brisanje:</strong> Klikni na <strong>"Obriši"</strong> pored linka koji želiš ukloniti. Potvrdi brisanje.</li>
                <li><strong>Uređivanje:</strong> Klikni na <strong>"Uredi"</strong> pored linka. Naslov će se pretvoriti u polje za unos. Upiši novi naslov i klikni <strong>"Spremi"</strong> da potvrdiš ili <strong>"Odustani"</strong> da poništiš promjene.</li>
                <li>Kada završiš s uređivanjem, ponovno klikni na gumb <strong>"Završi uređivanje"</strong> (crveni gumb) za izlaz iz načina uređivanja.</li>
            </ol>

            <h3>4. Izvoz i uvoz linkova:</h3>
            <ul>
                <li><strong>Izvezi linkove (.json):</strong> Klikni na <strong>"Izvezi linkove (.json)"</strong> za preuzimanje svih svojih linkova u JSON formatu. Ovo je korisno za sigurnosnu kopiju.</li>
                <li><strong>Uvezi linkove (.json):</strong> Klikni na <strong>"Uvezi linkove (.json)"</strong>, odaberi JSON datoteku s linkovima sa svog računala. Imat ćeš opciju da <strong>zamijeniš sve postojeće linkove</strong> ili da <strong>dodaš nove linkove</strong> postojećima.</li>
                <li><strong>Obriši sve linkove:</strong> Klikni na <strong>"Obriši sve linkove"</strong> za trajno brisanje svih spremljenih linkova. Budi oprezan, ova radnja se ne može poništiti!</li>
            </ul>

            <hr>

            <h2>Moje Bilješke</h2>
            <p>Ova sekcija služi za spremanje tvojih osobnih bilješki, ideja i podsjetnika.</p>

            <h3>1. Dodaj novu bilješku:</h3>
            <ul>
                <li>U polje <strong>"Naslov bilješke"</strong> unesi opcionalni naslov.</li>
                <li>U polje <strong>"Unesite tekst bilješke ovdje..."</strong> unesi sadržaj bilješke.</li>
                <li>Klikni na gumb <strong>"Dodaj Bilješku"</strong>. Bilješka će se pojaviti na listi spremljenih bilješki.</li>
            </ul>

            <h3>2. Spremljene bilješke:</h3>
            <ul>
                <li>Svaka bilješka prikazana je kao "post-it" kartica.</li>
                <li><strong>Otvori/Zatvori bilješku:</strong> Klikni na gumb <strong>"Otvori"</strong> (ili "Zatvori") u zaglavlju bilješke da proširiš ili skupiš njen sadržaj.</li>
                <li><strong>Paginacija:</strong> Kao i kod linkova, ako imaš mnogo bilješki, one će biti podijeljene na stranice (<strong>10 bilješki po stranici</strong>). Koristi gumbe "Prethodna", "Sljedeća" i numerirane gumbe na dnu liste za navigaciju.</li>
                <li><strong>Premještanje (Drag & Drop):</strong> Bilješke možeš preuređivati unutar trenutne stranice povlačenjem i ispuštanjem. Samo klikni i drži bilješku, povuci je na željeno mjesto i pusti. (Ovo ne radi dok je aktiviran "Način uređivanja").</li>
            </ul>

            <h3>3. Uređivanje i brisanje bilješki (način uređivanja):</h3>
            <ol>
                <li>Klikni na gumb <strong>"Uredi bilješke"</strong>. Gumb će postati crven, a na svakoj bilješci pojavit će se gumbi "Obriši" i "Uredi".</li>
                <li><strong>Brisanje:</strong> Klikni na <strong>"Obriši"</strong> pored bilješke koju želiš ukloniti. Potvrdi brisanje.</li>
                <li><strong>Uređivanje:</strong> Klikni na <strong>"Uredi"</strong> pored bilješke. Naslov i tekst će se pretvoriti u polja za unos. Upiši novi naslov i/ili tekst i klikni <strong>"Spremi"</strong> da potvrdiš ili <strong>"Odustani"</strong> da poništiš promjene. Bilješka će se automatski otvoriti kada je uređuješ.</li>
                <li>Kada završiš s uređivanjem, ponovno klikni na gumb <strong>"Završi uređivanje"</strong> (crveni gumb) za izlaz iz načina uređivanja.</li>
            </ol>

            <h3>4. Izvoz i uvoz bilješki:</h3>
            <ul>
                <li><strong>Izvezi bilješke (.json):</strong> Klikni na <strong>"Izvezi bilješke (.json)"</strong> za preuzimanje svih svojih bilješki u JSON formatu. Ovo je korisno za sigurnosnu kopiju.</li>
                <li><strong>Uvezi bilješke (.json):</strong> Klikni na <strong>"Uvezi bilješke (.json)"</strong>, odaberi JSON datoteku s bilješkama sa svog računala. Imat ćeš opciju da <strong>zamijeniš sve postojeće bilješke</strong> ili da <strong>dodaš nove bilješke</strong> postojećima.</li>
                <li><strong>Obriši sve bilješke:</strong> Klikni na <strong>"Obriši sve bilješke"</strong> za trajno brisanje svih spremljenih bilješki. Budi oprezan, ova radnja se ne može poništiti!</li>
            </ul>
        </div>
    </div>

    <div id="aboutModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('aboutModal')">&times;</span>
            <h1>O aplikaciji</h1>
            <p>Ova jednostavna aplikacija za upravljanje linkovima i bilješkama stvorena je kao praktično rješenje za organizaciju tvojih digitalnih resursa.</p>
            <p>Omogućuje ti da:</p>
            <ul>
                <li><strong>Spremaš i organiziraš web linkove</strong> s naslovima.</li>
                <li><strong>Zapisuješ i organiziraš osobne bilješke</strong>.</li>
                <li>Koristiš **paginaciju** za lakše pregledavanje velikog broja stavki.</li>
                <li>**Uređuješ i brišeš** pojedinačne stavke.</li>
                <li>**Premještaš linkove i bilješke** metodom povlačenja i ispuštanja (drag & drop) unutar trenutne stranice.</li>
                <li>**Izvoziš i uvoziš** podatke u JSON formatu za sigurnosnu kopiju ili prijenos između preglednika/uređaja.</li>
            </ul>
            <p>Svi podaci pohranjuju se isključivo u lokalnu memoriju tvog preglednika, osiguravajući privatnost i brzi pristup. Uživaj u organizaciji!</p>
            <p style="text-align: right; margin-top: 20px; font-size: 0.9em; color: #666;">Verzija 1.0 | 2025</p>
        </div>
    </div>

    <div id="authorModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('authorModal')">&times;</span>
            <h1>Informacije o autoru</h1>
            <p><strong>Autor:</strong> Gemini (Googleov AI asistent)</p>
            <p><strong>Nositelj ideje:</strong> Davor Đurinić</p>
            <p><strong>Verzija:</strong> 0.5</p>
            <p><strong>Datum:</strong> 19. lipnja 2025.</p>
            <p>Ova aplikacija je razvijena s ciljem pružanja jednostavnog i učinkovitog alata za osobnu organizaciju.</p>
        </div>
    </div>

    <div id="firstTimeNoteModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('firstTimeNoteModal')">&times;</span>
            <h1>Važna napomena o podacima</h1>
            <p>Ova aplikacija pohranjuje sve tvoje podatke (linkove i bilješke) isključivo u **lokalnu memoriju (Local Storage)** web preglednika koji koristiš.</p>
            <p>To znači da:</p>
            <ul>
                <li>Podaci su spremljeni samo u pregledniku na uređaju koji trenutno koristiš.</li>
                <li>Ako istu HTML datoteku otvoriš u **drugom pregledniku** (npr. Chrome umjesto Firefoxa), to će biti **potpuno nova, prazna instanca** aplikacije. Podaci se neće automatski prenijeti između preglednika.</li>
                <li>Slično, ako datoteku otvoriš na **drugom uređaju**, također ćeš početi s praznom aplikacijom.</li>
                <li>Za prijenos ili sigurnosnu kopiju podataka između preglednika ili uređaja, **obavezno koristi funkcije "Izvezi linkove (.json)" i "Izvezi bilješke (.json)"** te ih potom "Uvezi" na drugom mjestu.</li>
            </ul>
            <p style="text-align: center; margin-top: 20px;"><button onclick="closeModal('firstTimeNoteModal')">Razumijem</button></p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            loadLinks();
            loadNotes();

            // Dodaj event listenere za Drag & Drop na gridove
            document.getElementById('linkGrid').addEventListener('dragover', handleDragOver);
            document.getElementById('linkGrid').addEventListener('drop', (e) => handleDrop(e, 'link'));
            document.getElementById('notesGrid').addEventListener('dragover', handleDragOver);
            document.getElementById('notesGrid').addEventListener('drop', (e) => handleDrop(e, 'note'));
            
            // Zatvori modal klikom izvan sadržaja
            window.onclick = function(event) {
                const helpModal = document.getElementById('helpModal');
                const aboutModal = document.getElementById('aboutModal');
                const authorModal = document.getElementById('authorModal');
                const firstTimeNoteModal = document.getElementById('firstTimeNoteModal');

                if (event.target == helpModal) {
                    closeModal('helpModal');
                }
                if (event.target == aboutModal) {
                    closeModal('aboutModal');
                }
                if (event.target == authorModal) {
                    closeModal('authorModal');
                }
                if (event.target == firstTimeNoteModal) {
                    closeModal('firstTimeNoteModal');
                }
            }

            // Prikaz "Važne napomene" samo prvi put
            const hasSeenNote = localStorage.getItem('hasSeenFirstTimeNote');
            if (!hasSeenNote) {
                openModal('firstTimeNoteModal');
            }
        });

        let editModeLinks = false;
        let editModeNotes = false;

        // PAGINACIJA ZA LINKOVE
        const linksPerPage = 10;
        let currentPageLinks = 1;

        // PAGINACIJA ZA BILJEŠKE
        const notesPerPage = 10;
        let currentPageNotes = 1;

        // Varijable za Drag & Drop
        let draggedItem = null; // Pohranjuje DOM element koji se trenutno povlači
        let draggedItemGlobalIndex = -1; // Globalni indeks povučenog elementa u izvornom nizu

        // --- FUNKCIJE ZA MODALNE PROZORE ---
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
            if (modalId === 'firstTimeNoteModal') {
                localStorage.setItem('hasSeenFirstTimeNote', 'true'); // Postavi flag nakon otvaranja
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }


        // --- FUNKCIJE ZA DRAG & DROP ---

        function handleDragStart(e, type) {
            // Provjeri je li uređivanje aktivno - ako jest, ne dopusti povlačenje
            if ((type === 'link' && editModeLinks) || (type === 'note' && editModeNotes)) {
                e.preventDefault();
                return;
            }

            draggedItem = e.target;
            // Postavi globalni indeks povučenog elementa
            draggedItemGlobalIndex = parseInt(e.target.dataset.index);
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', e.target.dataset.index); // Pohrani indeks u dataTransfer
            
            // Dodaj klasu za vizualni feedback
            setTimeout(() => e.target.classList.add('dragging'), 0);
        }

        function handleDragOver(e) {
            e.preventDefault(); // Obavezno za omogućavanje dropa
            e.dataTransfer.dropEffect = 'move';

            const targetItem = e.target.closest('.link-item') || e.target.closest('.note-item');
            const gridContainer = e.target.closest('.link-grid') || e.target.closest('.notes-grid');

            // Ukloni drag-over klasu sa svih ostalih elemenata
            document.querySelectorAll('.drag-over').forEach(item => item.classList.remove('drag-over'));

            if (targetItem && targetItem !== draggedItem) {
                targetItem.classList.add('drag-over');
            } else if (!targetItem && gridContainer && gridContainer.children.length === 0) {
                // Ako je grid prazan i povlači se iznad njega
                gridContainer.classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
            e.target.classList.remove('drag-over');
            const targetItem = e.target.closest('.link-item') || e.target.closest('.note-item');
            if (targetItem) {
                targetItem.classList.remove('drag-over');
            }
        }

        function handleDragEnd(e) {
            // Ukloni sve klase za vizualni feedback
            e.target.classList.remove('dragging');
            document.querySelectorAll('.drag-over').forEach(item => item.classList.remove('drag-over'));
            draggedItem = null;
            draggedItemGlobalIndex = -1;
        }
        
        function handleDrop(e, type) {
            e.preventDefault();
            document.querySelectorAll('.drag-over').forEach(item => item.classList.remove('drag-over'));

            if (!draggedItem) return;

            const droppedOverItem = e.target.closest('.link-item') || e.target.closest('.note-item');
            const gridContainer = e.target.closest('.link-grid') || e.target.closest('.notes-grid');

            let items = (type === 'link') ? getLinks() : getNotes();
            
            // Pronađi originalni indeks povučenog elementa unutar trenutno prikazanih elemenata
            // Ovo je važno jer draggedItemGlobalIndex referencira originalni, globalni array
            const draggedItemCurrentPageIndex = items.slice((type === 'link' ? (currentPageLinks - 1) : (currentPageNotes - 1)) * (type === 'link' ? linksPerPage : notesPerPage), (type === 'link' ? (currentPageLinks - 1) : (currentPageNotes - 1)) * (type === 'link' ? linksPerPage : notesPerPage) + (type === 'link' ? linksPerPage : notesPerPage))
                                                   .findIndex(item => item === items[draggedItemGlobalIndex]);

            // Ako je dropano na prazan grid
            if (!droppedOverItem && gridContainer && gridContainer.children.length === 0) {
                // Ako je dropano na isti prazan grid odakle je povučeno, ne radi ništa
                if (draggedItem.parentNode.id === gridContainer.id) {
                    return; 
                }
                // Logika za premještanje u prazan grid (npr. s druge stranice ili iz drugog tipa podataka)
                // Trenutno ova aplikacija ne podržava premještanje između stranica ili tipova (link/note)
                // Ako se element povlači na prazan grid (gdje nema drugih elemenata), 
                // samo će se ponovno prikazati na istoj poziciji ako je s iste stranice.
                // Za složeniju logiku premještanja u prazan grid s druge stranice,
                // treba implementirati prijenos podataka između stranica ili čak tipova.
                
                // Za sada, ako je cilj prazan grid, samo osvježi prikaz.
                if (type === 'link') displayLinks(currentPageLinks);
                else displayNotes(currentPageNotes);
                return;
            }


            // Pronađi indeks elementa na koji je dropano unutar cijelog niza
            let droppedOverItemGlobalIndex = -1;
            if (droppedOverItem) {
                 droppedOverItemGlobalIndex = parseInt(droppedOverItem.dataset.index);
            }

            if (draggedItemGlobalIndex === droppedOverItemGlobalIndex || draggedItemGlobalIndex === -1) {
                // Ako se pokušava dropati na isti element ili indeks nije validan
                if (type === 'link') displayLinks(currentPageLinks);
                else displayNotes(currentPageNotes);
                return;
            }

            const [removed] = items.splice(draggedItemGlobalIndex, 1);
            items.splice(droppedOverItemGlobalIndex, 0, removed);

            if (type === 'link') {
                saveLinks(items);
                displayLinks(currentPageLinks);
            } else {
                saveNotes(items);
                displayNotes(currentPageNotes);
            }
        }


        // --- FUNKCIJE ZA LINKOVE (izmijenjene za Drag & Drop) ---

        function getLinks() {
            const linksString = localStorage.getItem('links');
            return linksString ? JSON.parse(linksString) : [];
        }

        function saveLinks(links) {
            localStorage.setItem('links', JSON.stringify(links));
        }

        function addLink() {
            const titleInput = document.getElementById('linkTitle');
            const urlInput = document.getElementById('linkUrl');

            const title = titleInput.value.trim();
            const url = urlInput.value.trim();

            if (title === '' || url === '') {
                alert('Molimo unesite i naslov i URL linka.');
                return;
            }

            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                alert('Molimo unesite valjan URL koji počinje s http:// ili https://');
                return;
            }

            const links = getLinks();
            links.push({ title, url });
            saveLinks(links);
            
            currentPageLinks = Math.ceil(links.length / linksPerPage);
            displayLinks(currentPageLinks);
            setupPaginationLinks();

            titleInput.value = '';
            urlInput.value = '';
        }

        function deleteLink(index) {
            if (confirm('Jeste li sigurni da želite obrisati ovaj link?')) {
                let links = getLinks();
                links.splice(index, 1);
                saveLinks(links);

                const totalPages = Math.ceil(links.length / linksPerPage);
                if (currentPageLinks > totalPages && totalPages > 0) {
                    currentPageLinks = totalPages;
                } else if (totalPages === 0) {
                    currentPageLinks = 1;
                }

                displayLinks(currentPageLinks);
                setupPaginationLinks();
            }
        }

        function displayLinks(page = currentPageLinks) {
            const linkGrid = document.getElementById('linkGrid');
            const noLinksMessage = document.getElementById('noLinksMessage');
            linkGrid.innerHTML = '';

            const allLinks = getLinks();

            if (allLinks.length === 0) {
                noLinksMessage.style.display = 'block';
                document.getElementById('paginationLinks').innerHTML = '';
                return;
            } else {
                noLinksMessage.style.display = 'none';
            }

            const startIndex = (page - 1) * linksPerPage;
            const endIndex = startIndex + linksPerPage;
            const linksToDisplay = allLinks.slice(startIndex, endIndex);

            linksToDisplay.forEach((link, localIndex) => {
                const globalIndex = startIndex + localIndex;

                const linkItem = document.createElement('div');
                linkItem.classList.add('link-item');
                if (editModeLinks) {
                    linkItem.classList.add('editing');
                }
                linkItem.dataset.index = globalIndex;
                linkItem.setAttribute('draggable', !editModeLinks); // Omogući/onemogući povlačenje ovisno o modu
                linkItem.style.cursor = editModeLinks ? 'default' : 'grab'; // Promijeni kursor

                linkItem.addEventListener('dragstart', (e) => handleDragStart(e, 'link'));
                linkItem.addEventListener('dragleave', handleDragLeave); // Dodano za vizualni feedback
                linkItem.addEventListener('dragend', handleDragEnd); // Dodano za čišćenje

                linkItem.innerHTML = `
                    <a href="${link.url}" target="_blank" rel="noopener noreferrer" class="link-title-display">${link.title}</a>
                    <input type="text" class="edit-title-input" value="${link.title}">
                    <span class="url-display">${link.url}</span>
                    <button class="delete-btn" onclick="deleteLink(${globalIndex})">Obriši</button>
                    <button class="edit-btn" onclick="startEditLink(${globalIndex})">Uredi</button>
                    <div class="edit-buttons">
                        <button class="save-btn" onclick="saveEditLink(${globalIndex})">Spremi</button>
                        <button class="cancel-btn" onclick="cancelEditLink(${globalIndex})">Odustani</button>
                    </div>
                `;
                linkGrid.appendChild(linkItem);
            });
            setupPaginationLinks();
        }

        function setupPaginationLinks() {
            const paginationContainer = document.getElementById('paginationLinks');
            paginationContainer.innerHTML = '';
            const allLinks = getLinks();
            const pageCount = Math.ceil(allLinks.length / linksPerPage);

            if (pageCount <= 1) {
                paginationContainer.style.display = 'none';
                return;
            } else {
                paginationContainer.style.display = 'flex';
            }

            const prevButton = document.createElement('button');
            prevButton.textContent = 'Prethodna';
            prevButton.disabled = currentPageLinks === 1;
            prevButton.onclick = () => goToPageLinks(currentPageLinks - 1);
            paginationContainer.appendChild(prevButton);

            for (let i = 1; i <= pageCount; i++) {
                const button = document.createElement('button');
                button.textContent = i;
                if (i === currentPageLinks) {
                    button.classList.add('active');
                }
                button.onclick = () => goToPageLinks(i);
                paginationContainer.appendChild(button);
            }

            const nextButton = document.createElement('button');
            nextButton.textContent = 'Sljedeća';
            nextButton.disabled = currentPageLinks === pageCount;
            nextButton.onclick = () => goToPageLinks(currentPageLinks + 1);
            paginationContainer.appendChild(nextButton);
        }

        function goToPageLinks(page) {
            currentPageLinks = page;
            displayLinks(currentPageLinks);
            document.getElementById('linksSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }


        function loadLinks() {
            displayLinks(currentPageLinks);
            setupPaginationLinks();
        }

        function exportLinks() {
            const links = getLinks();
            if (links.length === 0) {
                alert('Nema linkova za izvoz.');
                return;
            }

            const dataStr = JSON.stringify(links, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = 'moji_linkovi.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function importLinks(event) {
            const file = event.target.files[0];
            if (!file) {
                return;
            }

            const reader = new FileReader();

            reader.onload = function(e) {
                try {
                    const importedLinks = JSON.parse(e.target.result);
                    if (!Array.isArray(importedLinks)) {
                        alert('Datoteka ne sadrži valjan format linkova. Očekivan je niz.');
                        return;
                    }

                    const validImportedLinks = importedLinks.filter(link =>
                        typeof link.title === 'string' &&
                        typeof link.url === 'string' &&
                        (link.url.startsWith('http://') || link.url.startsWith('https://'))
                    );

                    if (importedLinks.length !== validImportedLinks.length) {
                        const confirmContinue = confirm('Neki uvezeni linkovi nisu valjani i bit će zanemareni. Želite li nastaviti?');
                        if (!confirmContinue) {
                            return;
                        }
                    }

                    if (confirm('Želite li zamijeniti SVE postojeće linkove s uvezenima? (OK za zamjenu, Odustani za dodavanje)')) {
                        saveLinks(validImportedLinks);
                        alert('Linkovi su uspješno uvezeni (zamijenjeni).');
                    } else {
                        const existingLinks = getLinks();
                        const combinedLinks = existingLinks.concat(validImportedLinks);
                        saveLinks(combinedLinks);
                        alert('Linkovi su uspješno uvezeni (dodani postojećim).');
                    }

                    currentPageLinks = 1;
                    displayLinks();
                    setupPaginationLinks();
                } catch (error) {
                    alert('Greška pri uvozu linkova. Provjerite je li datoteka valjan JSON format.');
                    console.error('Greška pri uvozu:', error);
                } finally {
                    event.target.value = '';
                }
            };

            reader.readAsText(file);
        }

        function clearAllLinks() {
            if (confirm('Jeste li sigurni da želite obrisati SVE linkove? Ova radnja se ne može poništiti.')) {
                localStorage.removeItem('links');
                currentPageLinks = 1;
                displayLinks();
                setupPaginationLinks();
                alert('Svi linkovi su obrisani.');
            }
        }

        function toggleEditModeLinks() {
            editModeLinks = !editModeLinks;
            const editModeBtn = document.getElementById('editModeBtnLinks');
            
            if (editModeLinks) {
                editModeBtn.textContent = 'Završi uređivanje';
                editModeBtn.classList.add('active');
                document.querySelectorAll('.link-item').forEach(item => {
                    item.classList.add('editing');
                    item.setAttribute('draggable', false); // Onemogući drag kad je edit mode aktivan
                    item.style.cursor = 'default';
                });
            } else {
                editModeBtn.textContent = 'Uredi linkove';
                editModeBtn.classList.remove('active');
                document.querySelectorAll('.link-item').forEach(item => {
                    item.classList.remove('editing');
                    item.classList.remove('editing-single');
                    item.setAttribute('draggable', true); // Omogući drag kad je edit mode neaktivan
                    item.style.cursor = 'grab';

                    const titleDisplay = item.querySelector('.link-title-display');
                    const titleInput = item.querySelector('.edit-title-input');
                    const editButtons = item.querySelector('.edit-buttons');
                    const deleteBtn = item.querySelector('.delete-btn');
                    const editBtn = item.querySelector('.edit-btn');

                    if (titleDisplay) titleDisplay.style.display = 'block';
                    if (titleInput) {
                        titleInput.style.display = 'none';
                        titleInput.value = titleDisplay ? titleDisplay.textContent : '';
                    }
                    if (editButtons) editButtons.style.display = 'none';
                    if (deleteBtn) deleteBtn.style.display = 'block';
                    if (editBtn) editBtn.style.display = 'block';
                });
            }
            displayLinks(currentPageLinks);
        }

        function startEditLink(index) {
            const linkItem = document.querySelector(`.link-item[data-index="${index}"]`);
            if (!linkItem) return;

            document.querySelectorAll('.link-item.editing-single').forEach(item => {
                if (item !== linkItem) {
                    item.classList.remove('editing-single');
                    const titleDisplay = item.querySelector('.link-title-display');
                    const titleInput = item.querySelector('.edit-title-input');
                    const editButtons = item.querySelector('.edit-buttons');
                    const deleteBtn = item.querySelector('.delete-btn');
                    const editBtn = item.querySelector('.edit-btn');

                    if (titleDisplay) titleDisplay.style.display = 'block';
                    if (titleInput) {
                        titleInput.style.display = 'none';
                        titleInput.value = titleDisplay ? titleDisplay.textContent : '';
                    }
                    if (editButtons) editButtons.style.display = 'none';
                    if (deleteBtn) deleteBtn.style.display = 'block';
                    if (editBtn) editBtn.style.display = 'block';
                }
            });

            linkItem.classList.add('editing-single');

            const titleDisplay = linkItem.querySelector('.link-title-display');
            const titleInput = linkItem.querySelector('.edit-title-input');
            const deleteBtn = linkItem.querySelector('.delete-btn');
            const editBtn = linkItem.querySelector('.edit-btn');
            const editButtons = linkItem.querySelector('.edit-buttons');

            titleDisplay.style.display = 'none';
            titleInput.style.display = 'block';
            titleInput.focus();
            titleInput.select();

            if (deleteBtn) deleteBtn.style.display = 'none';
            if (editBtn) editBtn.style.display = 'none';
            if (editButtons) editButtons.style.display = 'flex';
        }

        function saveEditLink(index) {
            const linkItem = document.querySelector(`.link-item[data-index="${index}"]`);
            if (!linkItem) return;

            const titleInput = linkItem.querySelector('.edit-title-input');
            const newTitle = titleInput.value.trim();

            if (newTitle === '') {
                alert('Naslov linka ne smije biti prazan.');
                return;
            }

            let links = getLinks();
            if (links[index]) {
                links[index].title = newTitle;
                saveLinks(links);
                displayLinks(currentPageLinks);
            }

            linkItem.classList.remove('editing-single');
        }

        function cancelEditLink(index) {
            const linkItem = document.querySelector(`.link-item[data-index="${index}"]`);
            if (!linkItem) return;

            linkItem.classList.remove('editing-single');

            const titleDisplay = linkItem.querySelector('.link-title-display');
            const titleInput = linkItem.querySelector('.edit-title-input');
            const deleteBtn = linkItem.querySelector('.delete-btn');
            const editBtn = linkItem.querySelector('.edit-btn');
            const editButtons = linkItem.querySelector('.edit-buttons');

            if (titleDisplay) titleDisplay.style.display = 'block';
            if (titleInput) {
                titleInput.style.display = 'none';
                titleInput.value = titleDisplay ? titleDisplay.textContent : '';
            }
            if (deleteBtn) deleteBtn.style.display = 'block';
            if (editBtn) editBtn.style.display = 'block';
            if (editButtons) editButtons.style.display = 'none';
        }

        // --- FUNKCIJE ZA BILJEŠKE (izmijenjene za Drag & Drop) ---

        function getNotes() {
            const notesString = localStorage.getItem('notes');
            return notesString ? JSON.parse(notesString) : [];
        }

        function saveNotes(notes) {
            localStorage.setItem('notes', JSON.stringify(notes));
        }

        function addNote() {
            const noteTitleInput = document.getElementById('noteTitle');
            const noteTextInput = document.getElementById('noteText');

            const title = noteTitleInput.value.trim();
            const text = noteTextInput.value.trim();

            if (text === '') {
                alert('Molimo unesite tekst bilješke.');
                return;
            }

            const notes = getNotes();
            notes.push({ title: title, text: text, timestamp: new Date().toISOString(), closed: false });
            saveNotes(notes);
            
            currentPageNotes = Math.ceil(notes.length / notesPerPage);
            displayNotes(currentPageNotes);
            setupPaginationNotes();

            noteTitleInput.value = '';
            noteTextInput.value = '';
        }

        function deleteNote(index) {
            if (confirm('Jeste li sigurni da želite obrisati ovu bilješku?')) {
                let notes = getNotes();
                notes.splice(index, 1);
                saveNotes(notes);

                const totalPages = Math.ceil(notes.length / notesPerPage);
                if (currentPageNotes > totalPages && totalPages > 0) {
                    currentPageNotes = totalPages;
                } else if (totalPages === 0) {
                    currentPageNotes = 1;
                }
                
                displayNotes(currentPageNotes);
                setupPaginationNotes();
            }
        }

        function displayNotes(page = currentPageNotes) {
            const notesGrid = document.getElementById('notesGrid');
            const noNotesMessage = document.getElementById('noNotesMessage');
            notesGrid.innerHTML = '';

            const allNotes = getNotes();
            
            if (allNotes.length === 0) {
                noNotesMessage.style.display = 'block';
                document.getElementById('paginationNotes').innerHTML = '';
                return;
            } else {
                noNotesMessage.style.display = 'none';
            }

            const startIndex = (page - 1) * notesPerPage;
            const endIndex = startIndex + notesPerPage;
            const notesToDisplay = allNotes.slice(startIndex, endIndex);

            notesToDisplay.forEach((note, localIndex) => {
                const globalIndex = startIndex + localIndex;

                const noteItem = document.createElement('div');
                noteItem.classList.add('note-item');
                if (note.closed) {
                    noteItem.classList.add('closed');
                }
                if (editModeNotes) {
                    noteItem.classList.add('editing-notes');
                }
                noteItem.dataset.index = globalIndex;
                noteItem.setAttribute('draggable', !editModeNotes); // Omogući/onemogući povlačenje ovisno o modu
                noteItem.style.cursor = editModeNotes ? 'default' : 'grab'; // Promijeni kursor

                noteItem.addEventListener('dragstart', (e) => handleDragStart(e, 'note'));
                noteItem.addEventListener('dragleave', handleDragLeave); // Dodano za vizualni feedback
                noteItem.addEventListener('dragend', handleDragEnd); // Dodano za čišćenje

                noteItem.innerHTML = `
                    <div class="note-header">
                        <h3 class="note-title-display">${note.title || 'Bez naslova'}</h3>
                        <button class="toggle-note-btn" onclick="toggleNoteContent(${globalIndex})"></button>
                    </div>
                    <input type="text" class="edit-title-input-note" value="${note.title || ''}">
                    <div class="note-content">
                        <p class="note-text-display">${note.text}</p>
                        <textarea class="edit-note-textarea">${note.text}</textarea>
                    </div>
                    <button class="delete-note-btn" onclick="deleteNote(${globalIndex})">Obriši</button>
                    <button class="edit-note-btn" onclick="startEditNote(${globalIndex})">Uredi</button>
                    <div class="note-edit-buttons">
                        <button class="save-note-btn" onclick="saveEditNote(${globalIndex})">Spremi</button>
                        <button class="cancel-note-btn" onclick="cancelEditNote(${globalIndex})">Odustani</button>
                    </div>
                `;
                notesGrid.appendChild(noteItem);
            });
            setupPaginationNotes();
        }

        function toggleNoteContent(index) {
            const noteItem = document.querySelector(`.note-item[data-index="${index}"]`);
            if (!noteItem) return;

            noteItem.classList.toggle('closed');

            let notes = getNotes();
            if (notes[index]) {
                notes[index].closed = noteItem.classList.contains('closed');
                saveNotes(notes);
            }
        }

        function setupPaginationNotes() {
            const paginationContainer = document.getElementById('paginationNotes');
            paginationContainer.innerHTML = '';
            const allNotes = getNotes();
            const pageCount = Math.ceil(allNotes.length / notesPerPage);

            if (pageCount <= 1) {
                paginationContainer.style.display = 'none';
                return;
            } else {
                paginationContainer.style.display = 'flex';
            }

            const prevButton = document.createElement('button');
            prevButton.textContent = 'Prethodna';
            prevButton.disabled = currentPageNotes === 1;
            prevButton.onclick = () => goToPageNotes(currentPageNotes - 1);
            paginationContainer.appendChild(prevButton);

            for (let i = 1; i <= pageCount; i++) {
                const button = document.createElement('button');
                button.textContent = i;
                if (i === currentPageNotes) {
                    button.classList.add('active');
                }
                button.onclick = () => goToPageNotes(i);
                paginationContainer.appendChild(button);
            }

            const nextButton = document.createElement('button');
            nextButton.textContent = 'Sljedeća';
            nextButton.disabled = currentPageNotes === pageCount;
            nextButton.onclick = () => goToPageNotes(currentPageNotes + 1);
            paginationContainer.appendChild(nextButton);
        }

        function goToPageNotes(page) {
            currentPageNotes = page;
            displayNotes(currentPageNotes);
            document.getElementById('notesSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function loadNotes() {
            displayNotes(currentPageNotes);
            setupPaginationNotes();
        }

        function exportNotes() {
            const notes = getNotes();
            if (notes.length === 0) {
                alert('Nema bilješki za izvoz.');
                return;
            }

            const dataStr = JSON.stringify(notes, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = 'moje_biljeske.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function importNotes(event) {
            const file = event.target.files[0];
            if (!file) {
                return;
            }

            const reader = new FileReader();

            reader.onload = function(e) {
                try {
                    const importedNotes = JSON.parse(e.target.result);
                    if (!Array.isArray(importedNotes)) {
                        alert('Datoteka ne sadrži valjan format bilješki. Očekivan je niz.');
                        return;
                    }

                    const validImportedNotes = importedNotes.map(note => ({
                        title: typeof note.title === 'string' ? note.title : '',
                        text: typeof note.text === 'string' ? note.text : '',
                        timestamp: note.timestamp || new Date().toISOString(),
                        closed: typeof note.closed === 'boolean' ? note.closed : false
                    })).filter(note => note.text !== '');

                    if (importedNotes.length !== validImportedNotes.length) {
                        const confirmContinue = confirm('Neke uvezene bilješke nisu valjane i bit će zanemarene. Želite li nastaviti?');
                        if (!confirmContinue) {
                            return;
                        }
                    }

                    if (confirm('Želite li zamijeniti SVE postojeće bilješke s uvezenima? (OK za zamjenu, Odustani za dodavanje)')) {
                        saveNotes(validImportedNotes);
                        alert('Bilješke su uspješno uvezene (zamijenjene).');
                    } else {
                        const existingNotes = getNotes();
                        const combinedNotes = existingNotes.concat(validImportedNotes);
                        saveNotes(combinedNotes);
                        alert('Bilješke su uspješno uvezene (dodane postojećim).');
                    }

                    currentPageNotes = 1;
                    displayNotes();
                    setupPaginationNotes();
                } catch (error) {
                    alert('Greška pri uvozu bilješki. Provjerite je li datoteka valjan JSON format.');
                    console.error('Greška pri uvozu:', error);
                } finally {
                    event.target.value = '';
                }
            };

            reader.readAsText(file);
        }

        function clearAllNotes() {
            if (confirm('Jeste li sigurni da želite obrisati SVE bilješke? Ova radnja se ne može poništiti.')) {
                localStorage.removeItem('notes');
                currentPageNotes = 1;
                displayNotes();
                setupPaginationNotes();
                alert('Sve bilješke su obrisane.');
            }
        }

        function toggleEditModeNotes() {
            editModeNotes = !editModeNotes;
            const editModeBtn = document.getElementById('editModeBtnNotes');
            
            if (editModeNotes) {
                editModeBtn.textContent = 'Završi uređivanje';
                editModeBtn.classList.add('active');
                document.querySelectorAll('.note-item').forEach(item => {
                    item.classList.add('editing-notes');
                    item.setAttribute('draggable', false); // Onemogući drag
                    item.style.cursor = 'default';
                });
            } else {
                editModeBtn.textContent = 'Uredi bilješke';
                editModeBtn.classList.remove('active');
                document.querySelectorAll('.note-item').forEach(item => {
                    item.classList.remove('editing-notes');
                    item.classList.remove('editing-single-note');
                    item.setAttribute('draggable', true); // Omogući drag
                    item.style.cursor = 'grab';

                    const titleDisplay = item.querySelector('.note-title-display');
                    const textDisplay = item.querySelector('.note-text-display');
                    const titleInput = item.querySelector('.edit-title-input-note');
                    const textAreaInput = item.querySelector('.edit-note-textarea');
                    const editButtons = item.querySelector('.note-edit-buttons');
                    const deleteBtn = item.querySelector('.delete-note-btn');
                    const editBtn = item.querySelector('.edit-note-btn');
                    const toggleBtn = item.querySelector('.toggle-note-btn');

                    if (titleDisplay) titleDisplay.style.display = 'block';
                    if (textDisplay) {
                        if (!item.classList.contains('closed')) {
                            textDisplay.style.display = 'block';
                        } else {
                            textDisplay.style.display = 'none';
                        }
                    }

                    if (titleInput) {
                        titleInput.style.display = 'none';
                        titleInput.value = titleDisplay ? titleDisplay.textContent : '';
                    }
                    if (textAreaInput) {
                        textAreaInput.style.display = 'none';
                        textAreaInput.value = textDisplay ? textDisplay.textContent : '';
                    }
                    if (editButtons) editButtons.style.display = 'none';

                    if (deleteBtn) deleteBtn.style.display = 'block';
                    if (editBtn) editBtn.style.display = 'block';
                    if (toggleBtn) toggleBtn.style.display = 'block';
                });
            }
            displayNotes(currentPageNotes);
        }


        function startEditNote(index) {
            const noteItem = document.querySelector(`.note-item[data-index="${index}"]`);
            if (!noteItem) return;

            document.querySelectorAll('.note-item.editing-single-note').forEach(item => {
                if (item !== noteItem) {
                    item.classList.remove('editing-single-note');
                    const titleDisplay = item.querySelector('.note-title-display');
                    const textDisplay = item.querySelector('.note-text-display');
                    const titleInput = item.querySelector('.edit-title-input-note');
                    const textAreaInput = item.querySelector('.edit-note-textarea');
                    const editButtons = item.querySelector('.note-edit-buttons');
                    const deleteBtn = item.querySelector('.delete-note-btn');
                    const editBtn = item.querySelector('.edit-note-btn');
                    const toggleBtn = item.querySelector('.toggle-note-btn');

                    if (titleDisplay) titleDisplay.style.display = 'block';
                    if (textDisplay) {
                        let notes = getNotes();
                        const currentNoteData = notes[parseInt(item.dataset.index)];
                        if (currentNoteData && currentNoteData.closed) {
                            textDisplay.style.display = 'none';
                        } else {
                            textDisplay.style.display = 'block';
                        }
                    }
                    if (titleInput) {
                        titleInput.style.display = 'none';
                        titleInput.value = titleDisplay ? titleDisplay.textContent : '';
                    }
                    if (textAreaInput) {
                        textAreaInput.style.display = 'none';
                        textAreaInput.value = textDisplay ? textDisplay.textContent : '';
                    }
                    if (editButtons) editButtons.style.display = 'none';
                    if (deleteBtn) deleteBtn.style.display = 'block';
                    if (editBtn) editBtn.style.display = 'block';
                    if (toggleBtn) toggleBtn.style.display = 'block';
                }
            });

            noteItem.classList.add('editing-single-note');
            noteItem.classList.remove('closed');
            let notes = getNotes();
            if (notes[index]) {
                notes[index].closed = false;
                saveNotes(notes);
            }


            const titleDisplay = noteItem.querySelector('.note-title-display');
            const textDisplay = noteItem.querySelector('.note-text-display');
            const titleInput = noteItem.querySelector('.edit-title-input-note');
            const textAreaInput = noteItem.querySelector('.edit-note-textarea');
            const deleteBtn = noteItem.querySelector('.delete-note-btn');
            const editBtn = noteItem.querySelector('.edit-note-btn');
            const toggleBtn = noteItem.querySelector('.toggle-note-btn');
            const editButtons = noteItem.querySelector('.note-edit-buttons');

            titleDisplay.style.display = 'none';
            textDisplay.style.display = 'none';
            titleInput.style.display = 'block';
            textAreaInput.style.display = 'block';
            titleInput.focus();
            titleInput.select();

            if (deleteBtn) deleteBtn.style.display = 'none';
            if (editBtn) editBtn.style.display = 'none';
            if (toggleBtn) toggleBtn.style.display = 'none';
            if (editButtons) editButtons.style.display = 'flex';
        }

        function saveEditNote(index) {
            const noteItem = document.querySelector(`.note-item[data-index="${index}"]`);
            if (!noteItem) return;

            const titleInput = noteItem.querySelector('.edit-title-input-note');
            const textAreaInput = noteItem.querySelector('.edit-note-textarea');
            const newTitle = titleInput.value.trim();
            const newText = textAreaInput.value.trim();

            if (newText === '') {
                alert('Tekst bilješke ne smije biti prazan.');
                return;
            }

            let notes = getNotes();
            if (notes[index]) {
                notes[index].title = newTitle;
                notes[index].text = newText;
                saveNotes(notes);
                displayNotes(currentPageNotes);
            }

            noteItem.classList.remove('editing-single-note');
        }

        function cancelEditNote(index) {
            const noteItem = document.querySelector(`.note-item[data-index="${index}"]`);
            if (!noteItem) return;

            noteItem.classList.remove('editing-single-note');

            const titleDisplay = noteItem.querySelector('.note-title-display');
            const textDisplay = noteItem.querySelector('.note-text-display');
            const titleInput = noteItem.querySelector('.edit-title-input-note');
            const textAreaInput = noteItem.querySelector('.edit-note-textarea');
            const deleteBtn = noteItem.querySelector('.delete-note-btn');
            const editBtn = noteItem.querySelector('.edit-note-btn');
            const toggleBtn = noteItem.querySelector('.toggle-note-btn');
            const editButtons = noteItem.querySelector('.note-edit-buttons');

            if (titleDisplay) titleDisplay.style.display = 'block';
            let notes = getNotes();
            const currentNoteData = notes[index];
            if (currentNoteData && currentNoteData.closed) {
                textDisplay.style.display = 'none';
            } else {
                textDisplay.style.display = 'block';
            }

            if (titleInput) {
                titleInput.style.display = 'none';
                titleInput.value = titleDisplay ? titleDisplay.textContent : '';
            }
            if (textAreaInput) {
                textAreaInput.style.display = 'none';
                textAreaInput.value = textDisplay ? textDisplay.textContent : '';
            }
            if (deleteBtn) deleteBtn.style.display = 'block';
            if (editBtn) editBtn.style.display = 'block';
            if (toggleBtn && !editModeNotes) toggleBtn.style.display = 'block';
            if (editButtons) editButtons.style.display = 'none';
        }
    </script>
</body>
</html>
