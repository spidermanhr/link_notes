<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upravitelj Linkovima i Bilješkama</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background-color: #f4f4f4;
            color: #333;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding-top: 60px; /* Dodajte padding da sadržaj ne bude ispod navbara */
        }

        /* --- NAVBAR STILOVI --- */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #0056b3;
            padding: 10px 20px;
            color: white;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            box-sizing: border-box;
            z-index: 1000; /* Osigurava da je navbar iznad ostalog sadržaja */
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .navbar-left .app-title {
            font-size: 1.3em;
            font-weight: bold;
            color: white; /* Da bi naslov bio bijele boje */
        }
        .navbar-right {
            display: flex;
            align-items: center;
        }
        .navbar-right button {
            color: white;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 5px;
            transition: background-color 0.3s ease;
            font-size: 1.1em;
            cursor: pointer;
            border: none;
            background: none;
        }
        .navbar-right button:hover {
            background-color: #004085;
        }
        .navbar-right button:not(:last-child) {
            margin-right: 10px; /* Razmak između gumba */
        }

        /* --- MODAL STILOVI --- */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 2000; /* Higher than navbar */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.6); /* Black w/ opacity */
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            max-width: 800px;
            width: 90%;
            position: relative;
            max-height: 90vh; /* Max height to allow scrolling */
            overflow-y: auto; /* Enable vertical scrolling */
            -webkit-animation-name: animatetop;
            -webkit-animation-duration: 0.4s;
            animation-name: animatetop;
            animation-duration: 0.4s
        }

        /* Add Animation */
        @-webkit-keyframes animatetop {
            from {top: -300px; opacity: 0}
            to {top: 0; opacity: 1}
        }
        @keyframes animatetop {
            from {top: -300px; opacity: 0}
            to {top: 0; opacity: 1}
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            top: 10px;
            right: 20px;
            cursor: pointer;
        }
        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
        }
        .modal-content h1, .modal-content h2, .modal-content h3 {
            color: #0056b3;
            margin-top: 15px;
        }
        .modal-content h1 { text-align: center; margin-bottom: 25px;}
        .modal-content h2 { border-bottom: 1px solid #eee; padding-bottom: 5px; margin-bottom: 15px;}
        .modal-content p, .modal-content ul, .modal-content ol {
            margin-bottom: 10px;
        }
        .modal-content hr {
            border: 0;
            height: 1px;
            background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));
            margin: 25px 0;
        }

        /* --- POSTOJEĆI STILOVI --- */
        .main-wrapper {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            width: 100%;
            max-width: 1400px; /* Povećana maksimalna širina */
            margin: 20px auto;
            box-sizing: border-box;
            padding: 0 20px;
        }
        .container {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            box-sizing: border-box;
            flex: 1;
            min-width: 400px; /* Povećana minimalna širina */
        }
        h1, h2 {
            color: #0056b3;
            text-align: center;
            margin-bottom: 20px;
        }
        input[type="text"], input[type="url"], textarea {
            width: calc(100% - 22px);
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }
        .action-buttons .export-btn {
            background-color: #28a745;
        }
        .action-buttons .export-btn:hover {
            background-color: #218838;
        }
        .action-buttons input[type="file"] {
            display: none;
        }
        .action-buttons label.button {
            background-color: #ffc107;
            color: #333;
            cursor: pointer;
            padding: 10px 15px;
            border-radius: 4px;
            display: inline-block;
            font-size: 16px;
            text-align: center;
            box-sizing: border-box;
            height: 42px;
            line-height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .action-buttons label.button:hover {
            background-color: #e0a800;
        }
        #editModeBtnLinks, #editModeBtnNotes {
            background-color: #6c757d;
        }
        #editModeBtnLinks.active, #editModeBtnNotes.active {
            background-color: #dc3545;
        }
        #editModeBtnLinks:hover, #editModeBtnNotes:hover {
            background-color: #5a6268;
        }
        #editModeBtnLinks.active:hover, #editModeBtnNotes.active:hover {
            background-color: #c82333;
        }
        
        /* Novi stil za "Obriši" gumbe */
        .action-buttons .delete-all-btn {
            background-color: #dc3545; /* Crvena boja */
        }
        .action-buttons .delete-all-btn:hover {
            background-color: #c82333; /* Tamnija crvena na hover */
        }

        /* --- STILOVI ZA LINKOVE (ISPRAVLJENO ZA TRI STUPCA) --- */
        .link-grid {
            display: grid;
            /* Postavljamo minimalnu širinu kolone na 250px, što bi trebalo omogućiti tri stupca.
                Koristimo auto-fit umjesto auto-fill kako bi se stupci "skupljali"
                ako ima manje elemenata, ali se širili ako nema dovoljno za 3. */
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            padding: 10px 0;
            min-height: 150px;
            /* Automatski prikaži 1 stupac ako je preostala samo 1 stavka */
            /* Ovo se rješava dinamički u JS-u, ali osiguravamo da se grid ne razvlači previše */
        }
        /* Ako je samo jedna stavka, želimo da zauzme cijelu širinu kontejnera (1 stupac) */
        .link-grid.single-item-layout {
            grid-template-columns: 1fr;
            max-width: 300px; /* Može se prilagoditi po želji za centriranje jedne stavke */
            margin: 0 auto; /* Centriranje jedne stavke */
        }

        .link-item {
            background-color: #e9e9e9;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: relative;
            overflow: hidden;
            box-sizing: border-box;
            cursor: grab;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
        }
        /* Stil za element koji se povlači */
        .link-item.dragging, .note-item.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }
        /* Stil za drop zonu */
        .link-item.drag-over, .note-item.drag-over {
            background-color: #d1ecf1; /* Svijetlo plava */
            border: 2px dashed #007bff;
        }

        .link-item a {
            text-decoration: none;
            color: #007bff;
            font-weight: bold;
            font-size: 1.1em;
            display: block;
            margin-bottom: 5px;
            word-break: break-word;
        }
        .link-item a:hover {
            text-decoration: underline;
        }
        .link-item .url-display {
            font-size: 0.9em;
            color: #555;
            word-break: break-word;
            margin-bottom: 10px;
        }
        .link-item .delete-btn, .link-item .edit-btn {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            position: absolute;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease-in-out;
            z-index: 10;
        }
        .link-item .edit-btn {
            background-color: #007bff;
        }
        .link-item .delete-btn { top: 10px; right: 10px; }
        .link-item .edit-btn { top: 10px; right: 80px; }
        .link-item.editing .delete-btn,
        .link-item.editing .edit-btn {
            opacity: 1;
            pointer-events: auto;
        }
        .link-item.editing-single .link-title-display {
            display: none;
        }
        .link-item .edit-title-input {
            width: calc(100% - 20px);
            padding: 5px;
            margin-bottom: 5px;
            border: 1px solid #007bff;
            border-radius: 4px;
            font-size: 1.1em;
            display: none;
        }
        .link-item.editing-single .edit-title-input {
            display: block;
        }
        .link-item .edit-buttons {
            display: none;
            justify-content: flex-end;
            margin-top: 10px;
        }
        .link-item.editing-single .edit-buttons {
            display: flex;
        }
        .link-item .edit-buttons button {
            position: static;
            opacity: 1;
            pointer-events: auto;
            margin-left: 5px;
            padding: 6px 12px;
            font-size: 0.9em;
        }
        .link-item .edit-buttons .save-btn { background-color: #28a745; }
        .link-item .edit-buttons .cancel-btn { background-color: #6c757d; }


        /* --- STILOVI ZA BILJEŠKE (ISPRAVLJENO ZA TRI STUPCA) --- */
        .notes-grid {
            display: grid;
            /* Postavljamo minimalnu širinu kolone na 250px. */
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            padding: 10px 0;
            min-height: 150px;
        }
        /* Ako je samo jedna stavka, želimo da zauzme cijelu širinu kontejnera (1 stupac) */
        .notes-grid.single-item-layout {
            grid-template-columns: 1fr;
            max-width: 300px; /* Može se prilagoditi po želji za centriranje jedne stavke */
            margin: 0 auto; /* Centriranje jedne stavke */
        }
        .note-item {
            background-color: #fffacd;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 3px 3px 5px rgba(0, 0, 0, 0.2);
            transform: rotate(calc(var(--rotation) * 1deg));
            margin-bottom: 0; /* Uklonjeno jer grid već ima gap */
            display: flex;
            flex-direction: column;
            position: relative;
            box-sizing: border-box;
            word-wrap: break-word;
            max-height: 500px;
            transition: max-height 0.3s ease-out, background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
            cursor: grab; /* Dodan kursor za drag */
        }
        .note-item.closed {
            max-height: 70px;
            padding-bottom: 15px;
        }
        .note-item.closed .note-content {
            display: none;
        }
        .note-item.closed .toggle-note-btn {
            background-color: #007bff;
        }
        .note-item.closed .toggle-note-btn::before {
            content: 'Otvori';
        }
        .note-item:not(.closed) .toggle-note-btn::before {
            content: 'Zatvori';
        }
        .note-item:nth-child(even) { --rotation: 2; }
        .note-item:nth-child(odd) { --rotation: -1; }
        .note-item:nth-child(3n) { --rotation: 3; }
        .note-item:nth-child(4n) { --rotation: -2; }
        .note-item:nth-child(5n) { --rotation: 1; }
        .note-item.editing-single-note { transform: rotate(0deg) !important; }

        .note-item .note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .note-item .note-title-display {
            font-weight: bold;
            font-size: 1.1em;
            color: #0056b3;
            margin: 0;
            flex-grow: 1;
            word-break: break-word;
        }
        .note-item .toggle-note-btn {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
            margin-left: 10px;
            flex-shrink: 0;
        }
        .note-item .toggle-note-btn:hover {
            opacity: 0.8;
        }
        .note-item .note-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        .note-item .note-text-display {
            font-size: 1em;
            line-height: 1.4;
            margin-bottom: 10px;
            white-space: pre-wrap;
        }
        .note-item .edit-title-input-note, .note-item .edit-note-textarea {
            width: calc(100% - 20px);
            padding: 5px;
            margin-bottom: 5px;
            border: 1px solid #ffc107;
            border-radius: 4px;
            font-size: 1em;
            display: none;
        }
        .note-item .edit-note-textarea {
            min-height: 80px;
        }
        .note-item.editing-single-note .note-title-display,
        .note-item.editing-single-note .note-text-display {
            display: none;
        }
        .note-item.editing-single-note .edit-title-input-note,
        .note-item.editing-single-note .edit-note-textarea {
            display: block;
        }
        .note-item .delete-note-btn, .note-item .edit-note-btn {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            position: absolute;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease-in-out;
            z-index: 10;
        }
        .note-item .edit-note-btn {
            background-color: #007bff;
        }
        .note-item .delete-note-btn { top: 10px; right: 10px; }
        .note-item .edit-note-btn { top: 10px; right: 80px; }
        .note-item.editing-notes .delete-note-btn,
        .note-item.editing-notes .edit-note-btn {
            opacity: 1;
            pointer-events: auto;
        }
        .note-item.editing-notes .toggle-note-btn {
            display: none;
        }
        .note-item .note-edit-buttons {
            display: none;
            justify-content: flex-end;
            margin-top: 10px;
        }
        .note-item.editing-single-note .note-edit-buttons {
            display: flex;
        }
        .note-item .note-edit-buttons button {
            position: static;
            opacity: 1;
            pointer-events: auto;
            margin-left: 5px;
            padding: 6px 12px;
            font-size: 0.9em;
        }
        .note-item .note-edit-buttons .save-note-btn { background-color: #28a745; }
        .note-item .note-edit-buttons .cancel-note-btn { background-color: #6c757d; }

        #noLinksMessage, #noNotesMessage {
            text-align: center;
            padding: 20px;
            color: #666;
            font-style: italic;
        }
        hr {
            border: 0;
            height: 1px;
            background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));
            margin: 20px 0;
        }
        .container hr {
            margin: 15px 0;
        }

        /* --- STILOVI ZA PAGINACIJU --- */
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            gap: 5px;
            flex-wrap: wrap;
        }
        .pagination button {
            background-color: #f0f0f0;
            color: #333;
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            min-width: 40px;
            text-align: center;
        }
        .pagination button:hover {
            background-color: #e2e2e2;
        }
        .pagination button.active {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }
        .pagination button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            color: #666;
        }

        /* --- STILOVI ZA TOOLTIP (Važna napomena) --- */
        .info-tooltip-container {
            position: relative;
            display: inline-block;
            margin-left: 10px; /* Razmak od gumba "Autor" */
            cursor: pointer;
            z-index: 1050; /* Veći z-index da bude iznad svega */
        }
        .info-tooltip-container .info-icon {
            background-color: #ffc107; /* Žuta pozadina */
            color: #333; /* Tamni tekst */
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 1.1em;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: background-color 0.2s ease;
        }
        .info-tooltip-container .info-icon:hover {
            background-color: #e0a800;
        }
        .info-tooltip-container .tooltip-content {
            visibility: hidden;
            opacity: 0;
            width: 300px; /* Širina oblačića */
            background-color: #fefefe;
            color: #333;
            text-align: left;
            border-radius: 8px;
            padding: 15px;
            position: absolute;
            z-index: 1;
            top: 120%; /* Pozicija ispod ikone */
            right: 0; /* Poravnaj desno s ikonom */
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: opacity 0.3s, visibility 0.3s;
            font-size: 0.9em;
            line-height: 1.5;
            border: 1px solid #ddd;
        }
        /* Strelica na vrhu tooltipa, opciono */
        .info-tooltip-container .tooltip-content::after {
            content: "";
            position: absolute;
            bottom: 100%;
            right: 15px; /* Poravnaj strelicu s desne strane */
            border-width: 8px;
            border-style: solid;
            border-color: transparent transparent #fefefe transparent;
        }
        .info-tooltip-container:hover .tooltip-content {
            visibility: visible;
            opacity: 1;
        }
        .info-tooltip-container .tooltip-content h4 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #0056b3;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        .info-tooltip-container .tooltip-content ul {
            padding-left: 20px;
            margin-top: 5px;
        }
        .info-tooltip-container .tooltip-content li {
            margin-bottom: 5px;
        }

        /* Novi stil za backup podsjetnik */
        .backup-reminder {
            background-color: #ffc107; /* Žuta pozadina */
            color: #333;
            text-align: center;
            padding: 15px;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            position: sticky; /* Sticky pozicija da ostane vidljiv pri skrolanju */
            top: 70px; /* Ispod navbara */
            z-index: 999;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap; /* Omogući prelamanje na manjim ekranima */
        }
        .backup-reminder .backup-button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em;
        }
        .backup-reminder .backup-button:hover {
            background-color: #0056b3;
        }


        /* Responzivnost */
        @media (max-width: 992px) {
            .main-wrapper {
                flex-direction: column;
                padding: 0 10px;
            }
            .container {
                flex: none;
                width: 100%;
            }
            .link-grid, .notes-grid {
                /* Na manjim ekranima, dopusti da auto-fit stavi 2 ili 1 stupac */
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
            .navbar {
                flex-direction: column;
                align-items: flex-start;
                padding: 10px;
            }
            .navbar-right {
                margin-top: 10px;
                width: 100%;
                justify-content: center;
            }
            .navbar-right button {
                flex-grow: 1;
                margin: 0 5px;
            }
            body {
                padding-top: 100px; /* Povećaj padding ako se navbar preklopi na 2 reda */
            }
            .backup-reminder {
                top: 100px; /* Prilagodi poziciju podsjetnika za manje ekrane */
            }
        }
        @media (max-width: 768px) {
            .link-grid, .notes-grid {
                /* Na još manjim ekranima, minimalna širina može biti manja */
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
        }
        @media (max-width: 480px) {
            .link-grid, .notes-grid {
                grid-template-columns: 1fr; /* Jedan stupac na najmanjim ekranima */
            }
            button, .action-buttons label.button {
                width: 100%;
                margin-right: 0;
                margin-bottom: 10px;
            }
            .action-buttons {
                flex-direction: column;
                align-items: stretch;
            }
            .navbar-right button {
                margin: 0 0 10px 0; /* Stack buttons vertically */
            }
            .navbar-right {
                flex-direction: column;
                align-items: stretch;
            }
            .info-tooltip-container {
                align-self: flex-end; /* Postavi tooltip na desni kraj */
                margin-top: 10px;
                margin-left: 0;
            }
            .info-tooltip-container .tooltip-content {
                width: 90vw; /* Povećaj širinu na manjim ekranima */
                right: 0;
                left: unset; /* Resetiraj lijevi položaj */
                transform: translateX(0%); /* Resetiraj transformaciju */
            }
            .info-tooltip-container .tooltip-content::after {
                right: 15px; /* Održavaj strelicu desno */
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-left">
            <span class="app-title">Linkovi i Bilješke</span>
        </div>
        <div class="navbar-right">
            <button onclick="openModal('helpModal')">Pomoć</button>
            <button onclick="openModal('aboutModal')">O aplikaciji</button>
            <button onclick="openModal('authorModal')">Autor</button>
            <div class="info-tooltip-container">
                <span class="info-icon">i</span>
                <div class="tooltip-content">
                    <h4>Važna napomena o podacima:</h4>
                    <p>Ova aplikacija pohranjuje sve tvoje podatke (linkove i bilješke) isključivo u **lokalnu memoriju (Local Storage)** web preglednika koji koristiš.</p>
                    <p>To znači da:</p>
                    <ul>
                        <li>Podaci su spremljeni samo u pregledniku na uređaju koji trenutno koristiš.</li>
                        <li>Ako istu HTML datoteku otvoriš u **drugom pregledniku** (npr. Chrome umjesto Firefoxa), to će biti **potpuno nova, prazna instanca** aplikacije. Podaci se neće automatski prenijeti između preglednika.</li>
                        <li>Slično, ako datoteku otvoriš na **drugom uređaju**, također ćeš početi s praznom aplikacijom.</li>
                        <li>**<span style="color: red;">Vrlo važno:</span> Ne premještaj ni preimenuj ovu HTML datoteku nakon što uneseš podatke!** Ako to učiniš, tvoji spremljeni linkovi i bilješke neće biti vidljivi, jer ih preglednik povezuje s originalnom lokacijom datoteke.</li>
                        <li>Za prijenos ili sigurnosnu kopiju podataka između preglednika ili uređaja, **obavezno koristi funkcije "Izvezi linkove (.json)" i "Izvezi bilješke (.json)"** te ih potom "Uvezi" na drugom mjestu.</li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <div class="main-wrapper">
        <div id="backupReminder" style="display: none;"></div> 

        <div class="container" id="linksSection">
            <h1>Upravitelj Linkovima</h1>

            <div class="action-buttons">
                <button onclick="openModal('addLinkModal')">Dodaj</button>
                <button id="editModeBtnLinks" onclick="toggleEditModeLinks()">Uredi</button>
                <button class="export-btn" onclick="exportLinks()">Izvoz (.json)</button>
                <input type="file" id="importFileLinks" accept=".json" onchange="importLinks(event)">
                <label for="importFileLinks" class="button">Uvoz (.json)</label>
                <button class="delete-all-btn" onclick="clearAllLinks()">Obriši</button>
            </div>

            <hr>

            <div class="link-list-section">
                <h2>Spremljeni linkovi</h2>
                <div id="linkGrid" class="link-grid">
                    </div>
                <p id="noLinksMessage" style="display: none;">Još nema spremljenih linkova.</p>
                <div id="paginationLinks" class="pagination">
                    </div>
            </div>
        </div>

        <div class="container" id="notesSection">
            <h1>Moje Bilješke</h1>

            <div class="action-buttons">
                <button onclick="openModal('addNoteModal')">Dodaj</button>
                <button id="editModeBtnNotes" onclick="toggleEditModeNotes()">Uredi</button>
                <button class="export-btn" onclick="exportNotes()">Izvoz (.json)</button>
                <input type="file" id="importFileNotes" accept=".json" onchange="importNotes(event)">
                <label for="importFileNotes" class="button">Uvoz (.json)</label>
                <button class="delete-all-btn" onclick="clearAllNotes()">Obriši</button>
            </div>

            <hr>

            <div class="note-list-section">
                <h2>Spremljene bilješke</h2>
                <div id="notesGrid" class="notes-grid">
                    </div>
                <p id="noNotesMessage" style="display: none;">Još nema spremljenih bilješki.</p>
                <div id="paginationNotes" class="pagination">
                    </div>
            </div>
        </div>
    </div>

    <div id="helpModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('helpModal')">&times;</span>
            <h1>Upute za korištenje aplikacije Upravitelj Linkovima i Bilješkama</h1>
            <p>Dobrodošli u tvoju osobnu aplikaciju za organizaciju linkova i bilješki! Aplikacija ti omogućuje da jednostavno spremaš, pregledavaš, uređuješ i brišeš web linkove i osobne bilješke. Također, možeš ih izvesti i uvesti za sigurnosnu kopiju ili prijenos.</p>
            <p>Aplikacija se sastoji od dvije glavne sekcije: <strong>Upravitelj Linkovima</strong> (lijeva strana) i <strong>Moje Bilješke</strong> (desna strana).</p>

            <hr>

            <h2>Upravitelj Linkovima</h2>
            <p>Ova sekcija ti pomaže da organiziraš svoje omiljene web stranice.</p>

            <h3>1. Dodaj link:</h3>
            <ul>
                <li>Klikni na gumb <strong>"Dodaj"</strong> za otvaranje obrasca.</li>
                <li>U polje <strong>"Naslov linka"</strong> unesi naziv koji želiš dati linku (npr. "Moj omiljeni blog").</li>
                <li>U polje <strong>"URL linka"</strong> unesi punu web adresu (npr. <code>https://www.primjer.com</code>). Obavezno mora početi s <code>http://</code> ili <code>https://</code>.</li>
                <li>Klikni na gumb <strong>"Dodaj Link"</strong>. Link će se pojaviti na listi spremljenih linkova.</li>
            </ul>

            <h3>2. Spremljeni linkovi:</h3>
            <ul>
                <li>Svi tvoji spremljeni linkovi prikazani su u mreži. Klikom na <strong>naslov linka</strong> otvaraš link u novom tabu preglednika.</li>
                <li><strong>Paginacija:</strong> Ako imaš mnogo linkova, oni će biti podijeljeni na stranice (<strong>15 linkova po stranici</strong>). Koristi gumbe "Prethodna", "Sljedeća" i numerirane gumbe na dnu liste za navigaciju kroz stranice.</li>
                <li><strong>Premještanje (Drag & Drop):</strong> Linkove možeš preuređivati unutar trenutne stranice povlačenjem i ispuštanjem. Samo klikni i drži link, povuci ga na željeno mjesto i pusti. (Ovo ne radi dok je aktiviran "Način uređivanja").</li>
            </ul>

            <h3>3. Uređivanje i brisanje linkova (način uređivanja):</h3>
            <ol>
                <li>Klikni na gumb <strong>"Uredi"</strong>. Gumb će postati crven, a na svakom linku pojavit će se gumbi "Obriši" i "Uredi".</li>
                <li><strong>Brisanje:</strong> Klikni na <strong>"Obriši"</strong> pored linka koji želiš ukloniti. Potvrdi brisanje.</li>
                <li><strong>Uređivanje:</strong> Klikni na <strong>"Uredi"</strong> pored linka. Naslov će se pretvoriti u polje za unos. Upiši novi naslov i klikni <strong>"Spremi"</strong> da potvrdiš ili <strong>"Odustani"</strong> da poništiš promjene.</li>
                <li>Kada završiš s uređivanjem, ponovno klikni na gumb <strong>"Završi uređivanje"</strong> (crveni gumb) za izlaz iz načina uređivanja.</li>
            </ol>

            <h3>4. Izvoz i uvoz linkova:</h3>
            <ul>
                <li><strong>Izvoz (.json):</strong> Klikni na <strong>"Izvoz (.json)"</strong> za preuzimanje svih svojih linkova u JSON formatu. Ovo je korisno za sigurnosnu kopiju.</li>
                <li><strong>Uvoz (.json):</strong> Klikni na <strong>"Uvoz (.json)"</strong>, odaberi JSON datoteku s linkovima sa svog računala. Imat ćeš opciju da <strong>zamijeniš sve postojeće linkove</strong> ili da <strong>dodaš nove linkove</strong> postojećima.</li>
                <li><strong>Obriši:</strong> Klikni na <strong>"Obriši"</strong> za trajno brisanje svih spremljenih linkova. Budi oprezan, ova radnja se ne može poništiti!</li>
            </ul>

            <hr>

            <h2>Moje Bilješke</h2>
            <p>Ova sekcija služi za spremanje tvojih osobnih bilješki, ideja i podsjetnika.</p>

            <h3>1. Dodaj bilješku:</h3>
            <ul>
                <li>Klikni na gumb <strong>"Dodaj"</strong> za otvaranje obrasca.</li>
                <li>U polje <strong>"Naslov bilješke"</strong> unesi kratak naslov za svoju bilješku.</li>
                <li>U polje <strong>"Sadržaj bilješke"</strong> unesi tekst bilješke.</li>
                <li>Klikni na gumb <strong>"Dodaj Bilješku"</strong>. Bilješka će se pojaviti na listi.</li>
            </ul>

            <h3>2. Spremljene bilješke:</h3>
            <ul>
                <li>Sve tvoje spremljene bilješke prikazane su u mreži, izgledaju kao "ljepljive bilješke".</li>
                <li><strong>Otvori/Zatvori:</strong> Klikni na gumb <strong>"Otvori"</strong> (ili "Zatvori") u zaglavlju bilješke da prikažeš/sakriješ cijeli sadržaj bilješke.</li>
                <li><strong>Paginacija:</strong> Ako imaš mnogo bilješki, one će biti podijeljene na stranice (<strong>15 bilješki po stranici</strong>). Koristi gumbe "Prethodna", "Sljedeća" i numerirane gumbe na dnu liste za navigaciju kroz stranice.</li>
                <li><strong>Premještanje (Drag & Drop):</strong> Bilješke možeš preuređivati unutar trenutne stranice povlačenjem i ispuštanjem. Samo klikni i drži bilješku, povuci je na željeno mjesto i pusti. (Ovo ne radi dok je aktiviran "Način uređivanja").</li>
            </ul>

            <h3>3. Uređivanje i brisanje bilješki (način uređivanja):</h3>
            <ol>
                <li>Klikni na gumb <strong>"Uredi"</strong>. Gumb će postati crven, a na svakoj bilješci pojavit će se gumbi "Obriši" i "Uredi". Gumb "Otvori/Zatvori" bit će privremeno skriven.</li>
                <li><strong>Brisanje:</strong> Klikni na <strong>"Obriši"</strong> pored bilješke koju želiš ukloniti. Potvrdi brisanje.</li>
                <li><strong>Uređivanje:</strong> Klikni na <strong>"Uredi"</strong> pored bilješke. Naslov i sadržaj će se pretvoriti u polja za unos. Upiši novi naslov i/ili sadržaj, te klikni <strong>"Spremi"</strong> da potvrdiš ili <strong>"Odustani"</strong> da poništiš promjene.</li>
                <li>Kada završiš s uređivanjem, ponovno klikni na gumb <strong>"Završi uređivanje"</strong> (crveni gumb) za izlaz iz načina uređivanja.</li>
            </ol>

            <h3>4. Izvoz i uvoz bilješki:</h3>
            <ul>
                <li><strong>Izvoz (.json):</strong> Klikni na <strong>"Izvoz (.json)"</strong> za preuzimanje svih svojih bilješki u JSON formatu. Ovo je korisno za sigurnosnu kopiju.</li>
                <li><strong>Uvoz (.json):</strong> Klikni na <strong>"Uvoz (.json)"</strong>, odaberi JSON datoteku s bilješkama sa svog računala. Imat ćeš opciju da <strong>zamijeniš sve postojeće bilješke</strong> ili da <strong>dodaš nove bilješke</strong> postojećima.</li>
                <li><strong>Obriši:</strong> Klikni na <strong>"Obriši"</strong> za trajno brisanje svih spremljenih bilješki. Budi oprezan, ova radnja se ne može poništiti!</li>
            </ul>

            <p><strong>Napomena o Local Storage-u:</strong> Svi tvoji podaci (linkovi i bilješke) spremaju se direktno u tvoj web preglednik. To znači da ostaju privatni i nisu poslani na nikakav server. Međutim, ako obrišeš povijest pregledavanja ili podatke stranice, tvoji podaci mogu biti izgubljeni. Zato je izvoz podataka ključan za sigurnost!</p>
            <p>Sretno s organizacijom!</p>
        </div>
    </div>

    <div id="aboutModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('aboutModal')">&times;</span>
            <h1>O aplikaciji Linkovi i Bilješke</h1>
            <p>Ova je aplikacija jednostavan i intuitivan alat za lokalno upravljanje tvojim digitalnim sadržajem – specifično, web linkovima i osobnim bilješkama.</p>
            <h3>Cilj aplikacije:</h3>
            <ul>
                <li>Pružiti korisnicima brz i jednostavan način za spremanje i organizaciju važnih web adresa.</li>
                <li>Omogućiti stvaranje i uređivanje osobnih bilješki u formatu "ljepljivih bilješki" za brze podsjetnike i ideje.</li>
                <li>Osigurati potpunu privatnost podataka jer se sve pohranjuje isključivo u lokalnu memoriju preglednika korisnika (Local Storage).</li>
                <li>Omogućiti korisnicima punu kontrolu nad svojim podacima putem funkcija izvoza i uvoza, čime se olakšava sigurnosna kopija i prijenos podataka.</li>
            </ul>
            <h3>Tehnologije korištene:</h3>
            <ul>
                <li><strong>HTML5:</strong> Struktura i semantika web stranice.</li>
                <li><strong>CSS3:</strong> Dizajn i stilizacija aplikacije, uključujući responzivni dizajn za različite veličine ekrana.</li>
                <li><strong>JavaScript (Vanilla JS):</strong> Sva interaktivna funkcionalnost, upravljanje podacima (Local Storage), dodavanje/brisanje/uređivanje linkova i bilješki, paginacija i Drag & Drop funkcionalnost.</li>
            </ul>
            <p>Aplikacija je dizajnirana da bude lagana i brza, bez potrebe za internetskom vezom nakon početnog učitavanja datoteke, te bez ovisnosti o vanjskim bibliotekama ili frameworkovima.</p>
            <p>Uživajte u korištenju!</p>
        </div>
    </div>

    <div id="authorModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('authorModal')">&times;</span>
            <h1>O autoru</h1>
            <p>Pozdrav! Ja sam Davor, strastveni samouki developer koji voli stvarati jednostavne i korisne alate.</p>
            <p>Ova aplikacija "Linkovi i Bilješke" nastala je iz osobne potrebe za boljom organizacijom digitalnog sadržaja, a želja mi je bila stvoriti nešto što je potpuno privatno, radi lokalno i ne zahtijeva nikakve vanjske servise ili korisničke račune.</p>
            <p>Kroz razvoj sam nastojao primijeniti principe čistog koda i responzivnog dizajna kako bi aplikacija bila ugodna za korištenje na svim uređajima.</p>
            <p>Ako imaš pitanja, prijedloge za poboljšanja ili si primijetio/la bug, slobodno se javi! Iako je ovo osobni projekt, uvijek sam otvoren za feedback.</p>
            <p>Hvala ti što koristiš moju aplikaciju!</p>
        </div>
    </div>

    <div id="addLinkModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('addLinkModal')">&times;</span>
            <h2>Dodaj Novi Link</h2>
            <input type="text" id="linkTitle" placeholder="Naslov linka" required>
            <input type="url" id="linkUrl" placeholder="URL linka (npr. https://www.primjer.com)" required>
            <button onclick="addLink()">Dodaj Link</button>
        </div>
    </div>

    <div id="addNoteModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('addNoteModal')">&times;</span>
            <h2>Dodaj Novu Bilješku</h2>
            <input type="text" id="noteTitle" placeholder="Naslov bilješke" required>
            <textarea id="noteContent" placeholder="Sadržaj bilješke" rows="5" required></textarea>
            <button onclick="addNote()">Dodaj Bilješku</button>
        </div>
    </div>

    <script>
        let links = [];
        let notes = [];
        const linksPerPage = 15;
        const notesPerPage = 15;
        let currentLinkPage = 1;
        let currentNotePage = 1;
        let isEditModeLinks = false;
        let isEditModeNotes = false;
        let draggedItem = null; // Za drag and drop

        // --- POMOĆNE FUNKCIJE ZA MODALE ---
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Zatvori modal ako korisnik klikne izvan njega
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            });
        };

        // --- FUNKCIJE ZA LINKOVE ---
        function saveLinks() {
            localStorage.setItem('links', JSON.stringify(links));
        }

        function loadLinks() {
            const storedLinks = localStorage.getItem('links');
            if (storedLinks) {
                links = JSON.parse(storedLinks);
            }
            displayLinks(currentLinkPage);
        }

        function addLink() {
            const titleInput = document.getElementById('linkTitle');
            const urlInput = document.getElementById('linkUrl');
            const title = titleInput.value.trim();
            let url = urlInput.value.trim();

            if (title && url) {
                // Provjeri i dodaj http:// ili https:// ako nedostaje
                if (!/^https?:\/\//i.test(url)) {
                    url = 'http://' + url;
                }
                links.push({ title, url });
                saveLinks();
                titleInput.value = '';
                urlInput.value = '';
                closeModal('addLinkModal');
                displayLinks(currentLinkPage);
            } else {
                alert('Molimo unesite i naslov i URL linka.');
            }
        }

        function displayLinks(page) {
            const linkGrid = document.getElementById('linkGrid');
            const noLinksMessage = document.getElementById('noLinksMessage');
            linkGrid.innerHTML = '';
            
            if (links.length === 0) {
                noLinksMessage.style.display = 'block';
                document.getElementById('paginationLinks').innerHTML = ''; // Sakrij paginaciju ako nema linkova
                return;
            } else {
                noLinksMessage.style.display = 'none';
            }

            // Provjeri layout za jednu stavku
            if (links.length === 1 && !isEditModeLinks) { // Samo ako nije u modu uređivanja
                linkGrid.classList.add('single-item-layout');
            } else {
                linkGrid.classList.remove('single-item-layout');
            }

            const startIndex = (page - 1) * linksPerPage;
            const endIndex = startIndex + linksPerPage;
            const linksToDisplay = links.slice(startIndex, endIndex);

            linksToDisplay.forEach((link, indexInPage) => {
                const globalIndex = startIndex + indexInPage;
                const linkItem = document.createElement('div');
                linkItem.classList.add('link-item');
                linkItem.setAttribute('draggable', !isEditModeLinks); // Omogući drag samo ako nije u modu uređivanja
                linkItem.dataset.index = globalIndex; // Dodaj data-index za lakše pronalaženje u listi

                linkItem.innerHTML = `
                    <h3 class="link-title-display"><a href="${link.url}" target="_blank" rel="noopener noreferrer">${link.title}</a></h3>
                    <p class="url-display">${link.url}</p>
                    <input type="text" class="edit-title-input" value="${link.title}">
                    <div class="edit-buttons">
                        <button class="save-btn" onclick="saveEditedLink(${globalIndex})">Spremi</button>
                        <button class="cancel-btn" onclick="cancelEditLink(${globalIndex})">Odustani</button>
                    </div>
                    <button class="edit-btn" onclick="editLink(${globalIndex})">Uredi</button>
                    <button class="delete-btn" onclick="deleteLink(${globalIndex})">Obriši</button>
                `;
                linkGrid.appendChild(linkItem);
            });

            // Primijeni mod uređivanja ako je aktivan
            if (isEditModeLinks) {
                document.querySelectorAll('#linkGrid .link-item').forEach(item => {
                    item.classList.add('editing');
                });
            } else {
                document.querySelectorAll('#linkGrid .link-item').forEach(item => {
                    item.classList.remove('editing');
                });
            }
            setupLinkDragAndDrop(); // Ponovno postavi D&D listenere
            setupLinkPagination();
        }

        function setupLinkDragAndDrop() {
            const linkItems = document.querySelectorAll('#linkGrid .link-item');
            linkItems.forEach(item => {
                item.addEventListener('dragstart', handleLinkDragStart);
                item.addEventListener('dragover', handleLinkDragOver);
                item.addEventListener('dragleave', handleLinkDragLeave);
                item.addEventListener('drop', handleLinkDrop);
                item.addEventListener('dragend', handleLinkDragEnd);
            });
        }

        function handleLinkDragStart(e) {
            if (isEditModeLinks) { // Ne dopusti drag u modu uređivanja
                e.preventDefault();
                return;
            }
            draggedItem = e.target;
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', e.target.dataset.index);
            setTimeout(() => {
                draggedItem.classList.add('dragging');
            }, 0);
        }

        function handleLinkDragOver(e) {
            e.preventDefault();
            if (draggedItem && draggedItem !== e.target && e.target.classList.contains('link-item')) {
                e.dataTransfer.dropEffect = 'move';
                e.target.classList.add('drag-over');
            }
        }

        function handleLinkDragLeave(e) {
            if (e.target.classList.contains('link-item')) {
                e.target.classList.remove('drag-over');
            }
        }

        function handleLinkDrop(e) {
            e.preventDefault();
            if (draggedItem && draggedItem !== e.target && e.target.classList.contains('link-item')) {
                const dropTarget = e.target;
                const draggedIndex = parseInt(draggedItem.dataset.index);
                const dropIndex = parseInt(dropTarget.dataset.index);

                // Makni klase za povlačenje
                dropTarget.classList.remove('drag-over');
                draggedItem.classList.remove('dragging');

                // Ažuriraj redoslijed u "links" arrayu
                const [movedLink] = links.splice(draggedIndex, 1);
                links.splice(dropIndex, 0, movedLink);

                saveLinks();
                displayLinks(currentLinkPage); // Ponovno iscrtaj trenutnu stranicu
            }
        }

        function handleLinkDragEnd(e) {
            draggedItem.classList.remove('dragging');
            document.querySelectorAll('.link-item.drag-over').forEach(item => {
                item.classList.remove('drag-over');
            });
            draggedItem = null;
        }

        function setupLinkPagination() {
            const paginationLinks = document.getElementById('paginationLinks');
            paginationLinks.innerHTML = '';
            const totalPages = Math.ceil(links.length / linksPerPage);

            if (totalPages <= 1) return;

            const prevButton = document.createElement('button');
            prevButton.textContent = 'Prethodna';
            prevButton.disabled = currentLinkPage === 1;
            prevButton.onclick = () => {
                if (currentLinkPage > 1) {
                    currentLinkPage--;
                    displayLinks(currentLinkPage);
                }
            };
            paginationLinks.appendChild(prevButton);

            for (let i = 1; i <= totalPages; i++) {
                const pageButton = document.createElement('button');
                pageButton.textContent = i;
                if (i === currentLinkPage) {
                    pageButton.classList.add('active');
                }
                pageButton.onclick = () => {
                    currentLinkPage = i;
                    displayLinks(currentLinkPage);
                };
                paginationLinks.appendChild(pageButton);
            }

            const nextButton = document.createElement('button');
            nextButton.textContent = 'Sljedeća';
            nextButton.disabled = currentLinkPage === totalPages;
            nextButton.onclick = () => {
                if (currentLinkPage < totalPages) {
                    currentLinkPage++;
                    displayLinks(currentLinkPage);
                }
            };
            paginationLinks.appendChild(nextButton);
        }

        function toggleEditModeLinks() {
            isEditModeLinks = !isEditModeLinks;
            const editBtn = document.getElementById('editModeBtnLinks');
            editBtn.classList.toggle('active', isEditModeLinks);
            editBtn.textContent = isEditModeLinks ? 'Završi uređivanje' : 'Uredi';

            // Resetuj sve "editing-single" modove kada se toggla globalni edit mod
            document.querySelectorAll('#linkGrid .link-item').forEach(item => {
                item.classList.remove('editing-single');
            });

            displayLinks(currentLinkPage); // Ponovno prikaži linkove da se ažuriraju gumbi
        }

        function editLink(index) {
            const linkItem = document.querySelector(`.link-item[data-index="${index}"]`);
            if (linkItem) {
                linkItem.classList.add('editing-single');
                const titleInput = linkItem.querySelector('.edit-title-input');
                titleInput.value = links[index].title; // Postavi trenutnu vrijednost
                titleInput.focus();
            }
        }

        function saveEditedLink(index) {
            const linkItem = document.querySelector(`.link-item[data-index="${index}"]`);
            if (linkItem) {
                const newTitle = linkItem.querySelector('.edit-title-input').value.trim();
                if (newTitle) {
                    links[index].title = newTitle;
                    saveLinks();
                    linkItem.classList.remove('editing-single');
                    displayLinks(currentLinkPage); // Osvježi prikaz
                } else {
                    alert('Naslov linka ne može biti prazan.');
                }
            }
        }

        function cancelEditLink(index) {
            const linkItem = document.querySelector(`.link-item[data-index="${index}"]`);
            if (linkItem) {
                linkItem.classList.remove('editing-single');
                displayLinks(currentLinkPage); // Osvježi prikaz da se vrati originalni naslov
            }
        }

        function deleteLink(index) {
            if (confirm('Jeste li sigurni da želite obrisati ovaj link?')) {
                links.splice(index, 1);
                saveLinks();
                // Ako smo obrisali zadnji link na stranici, prebaci na prethodnu
                if (currentLinkPage > 1 && links.slice((currentLinkPage - 1) * linksPerPage, currentLinkPage * linksPerPage).length === 0) {
                    currentLinkPage--;
                }
                displayLinks(currentLinkPage);
            }
        }

        function clearAllLinks() {
            if (confirm('Jeste li sigurni da želite trajno obrisati SVE linkove? Ova radnja se ne može poništiti!')) {
                links = [];
                saveLinks();
                currentLinkPage = 1; // Resetuj na prvu stranicu
                displayLinks(currentLinkPage);
                alert('Svi linkovi su obrisani.');
            }
        }

        function exportLinks() {
            if (links.length === 0) {
                alert('Nema linkova za izvoz.');
                return;
            }
            const dataStr = JSON.stringify(links, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'mojilinkovi.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            alert('Linkovi uspješno izvezeni!');
            // Zabilježi datum backupa
            localStorage.setItem('lastBackupDate', new Date().toISOString());
            displayBackupReminder(); // Ažuriraj podsjetnik nakon backupa
        }

        function importLinks(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if (!Array.isArray(importedData) || !importedData.every(item => item.title && item.url)) {
                        alert('Datoteka nije ispravan format za linkove.');
                        return;
                    }

                    const confirmImport = confirm('Želite li zamijeniti sve postojeće linkove ili dodati nove linkove postojećima?\n\nOK za ZAMJENU SVIH; Odustani za DODAVANJE NOVIH.');
                    if (confirmImport) {
                        links = importedData;
                        alert('Linkovi uspješno zamijenjeni!');
                    } else {
                        links = links.concat(importedData);
                        alert('Linkovi uspješno dodani!');
                    }
                    saveLinks();
                    currentLinkPage = 1; // Vrati na prvu stranicu nakon uvoza
                    displayLinks(currentLinkPage);
                } catch (error) {
                    alert('Greška prilikom uvoza linkova: ' + error.message);
                }
            };
            reader.readAsText(file);
            event.target.value = ''; // Resetiraj input file element
        }

        // --- FUNKCIJE ZA BILJEŠKE ---
        function saveNotes() {
            localStorage.setItem('notes', JSON.stringify(notes));
        }

        function loadNotes() {
            const storedNotes = localStorage.getItem('notes');
            if (storedNotes) {
                notes = JSON.parse(storedNotes);
            }
            displayNotes(currentNotePage);
        }

        function addNote() {
            const titleInput = document.getElementById('noteTitle');
            const contentInput = document.getElementById('noteContent');
            const title = titleInput.value.trim();
            const content = contentInput.value.trim();

            if (title && content) {
                notes.push({ title, content, closed: false }); // Dodaj 'closed' property
                saveNotes();
                titleInput.value = '';
                contentInput.value = '';
                closeModal('addNoteModal');
                displayNotes(currentNotePage);
            } else {
                alert('Molimo unesite i naslov i sadržaj bilješke.');
            }
        }

        function displayNotes(page) {
            const notesGrid = document.getElementById('notesGrid');
            const noNotesMessage = document.getElementById('noNotesMessage');
            notesGrid.innerHTML = '';

            if (notes.length === 0) {
                noNotesMessage.style.display = 'block';
                document.getElementById('paginationNotes').innerHTML = ''; // Sakrij paginaciju
                return;
            } else {
                noNotesMessage.style.display = 'none';
            }

             // Provjeri layout za jednu stavku
             if (notes.length === 1 && !isEditModeNotes) { // Samo ako nije u modu uređivanja
                notesGrid.classList.add('single-item-layout');
            } else {
                notesGrid.classList.remove('single-item-layout');
            }

            const startIndex = (page - 1) * notesPerPage;
            const endIndex = startIndex + notesPerPage;
            const notesToDisplay = notes.slice(startIndex, endIndex);

            notesToDisplay.forEach((note, indexInPage) => {
                const globalIndex = startIndex + indexInPage;
                const noteItem = document.createElement('div');
                noteItem.classList.add('note-item');
                if (note.closed) { // Provjeri stanje bilješke
                    noteItem.classList.add('closed');
                }
                noteItem.setAttribute('draggable', !isEditModeNotes); // Omogući drag samo ako nije u modu uređivanja
                noteItem.dataset.index = globalIndex; // Dodaj data-index

                noteItem.innerHTML = `
                    <div class="note-header">
                        <h3 class="note-title-display">${note.title}</h3>
                        <button class="toggle-note-btn" onclick="toggleNote(${globalIndex})"></button>
                    </div>
                    <div class="note-content">
                        <p class="note-text-display">${note.content}</p>
                        <input type="text" class="edit-title-input-note" value="${note.title}">
                        <textarea class="edit-note-textarea">${note.content}</textarea>
                        <div class="note-edit-buttons">
                            <button class="save-note-btn" onclick="saveEditedNote(${globalIndex})">Spremi</button>
                            <button class="cancel-note-btn" onclick="cancelEditNote(${globalIndex})">Odustani</button>
                        </div>
                    </div>
                    <button class="edit-note-btn" onclick="editNote(${globalIndex})">Uredi</button>
                    <button class="delete-note-btn" onclick="deleteNote(${globalIndex})">Obriši</button>
                `;
                notesGrid.appendChild(noteItem);
            });

            // Primijeni mod uređivanja ako je aktivan
            if (isEditModeNotes) {
                document.querySelectorAll('#notesGrid .note-item').forEach(item => {
                    item.classList.add('editing-notes');
                });
            } else {
                document.querySelectorAll('#notesGrid .note-item').forEach(item => {
                    item.classList.remove('editing-notes');
                });
            }
            setupNoteDragAndDrop();
            setupNotePagination();
        }

        function setupNoteDragAndDrop() {
            const noteItems = document.querySelectorAll('#notesGrid .note-item');
            noteItems.forEach(item => {
                item.addEventListener('dragstart', handleNoteDragStart);
                item.addEventListener('dragover', handleNoteDragOver);
                item.addEventListener('dragleave', handleNoteDragLeave);
                item.addEventListener('drop', handleNoteDrop);
                item.addEventListener('dragend', handleNoteDragEnd);
            });
        }

        function handleNoteDragStart(e) {
            if (isEditModeNotes) {
                e.preventDefault();
                return;
            }
            draggedItem = e.target;
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', e.target.dataset.index);
            setTimeout(() => {
                draggedItem.classList.add('dragging');
            }, 0);
        }

        function handleNoteDragOver(e) {
            e.preventDefault();
            if (draggedItem && draggedItem !== e.target && e.target.classList.contains('note-item')) {
                e.dataTransfer.dropEffect = 'move';
                e.target.classList.add('drag-over');
            }
        }

        function handleNoteDragLeave(e) {
            if (e.target.classList.contains('note-item')) {
                e.target.classList.remove('drag-over');
            }
        }

        function handleNoteDrop(e) {
            e.preventDefault();
            if (draggedItem && draggedItem !== e.target && e.target.classList.contains('note-item')) {
                const dropTarget = e.target;
                const draggedIndex = parseInt(draggedItem.dataset.index);
                const dropIndex = parseInt(dropTarget.dataset.index);

                dropTarget.classList.remove('drag-over');
                draggedItem.classList.remove('dragging');

                const [movedNote] = notes.splice(draggedIndex, 1);
                notes.splice(dropIndex, 0, movedNote);

                saveNotes();
                displayNotes(currentNotePage);
            }
        }

        function handleNoteDragEnd(e) {
            draggedItem.classList.remove('dragging');
            document.querySelectorAll('.note-item.drag-over').forEach(item => {
                item.classList.remove('drag-over');
            });
            draggedItem = null;
        }

        function setupNotePagination() {
            const paginationNotes = document.getElementById('paginationNotes');
            paginationNotes.innerHTML = '';
            const totalPages = Math.ceil(notes.length / notesPerPage);

            if (totalPages <= 1) return;

            const prevButton = document.createElement('button');
            prevButton.textContent = 'Prethodna';
            prevButton.disabled = currentNotePage === 1;
            prevButton.onclick = () => {
                if (currentNotePage > 1) {
                    currentNotePage--;
                    displayNotes(currentNotePage);
                }
            };
            paginationNotes.appendChild(prevButton);

            for (let i = 1; i <= totalPages; i++) {
                const pageButton = document.createElement('button');
                pageButton.textContent = i;
                if (i === currentNotePage) {
                    pageButton.classList.add('active');
                }
                pageButton.onclick = () => {
                    currentNotePage = i;
                    displayNotes(currentNotePage);
                };
                paginationNotes.appendChild(pageButton);
            }

            const nextButton = document.createElement('button');
            nextButton.textContent = 'Sljedeća';
            nextButton.disabled = currentNotePage === totalPages;
            nextButton.onclick = () => {
                if (currentNotePage < totalPages) {
                    currentNotePage++;
                    displayNotes(currentNotePage);
                }
            };
            paginationNotes.appendChild(nextButton);
        }

        function toggleEditModeNotes() {
            isEditModeNotes = !isEditModeNotes;
            const editBtn = document.getElementById('editModeBtnNotes');
            editBtn.classList.toggle('active', isEditModeNotes);
            editBtn.textContent = isEditModeNotes ? 'Završi uređivanje' : 'Uredi';

            document.querySelectorAll('#notesGrid .note-item').forEach(item => {
                item.classList.remove('editing-single-note');
            });
            displayNotes(currentNotePage);
        }

        function toggleNote(index) {
            const noteItem = document.querySelector(`.note-item[data-index="${index}"]`);
            if (noteItem) {
                noteItem.classList.toggle('closed');
                notes[index].closed = noteItem.classList.contains('closed'); // Ažuriraj stanje u podatcima
                saveNotes();
            }
        }

        function editNote(index) {
            const noteItem = document.querySelector(`.note-item[data-index="${index}"]`);
            if (noteItem) {
                noteItem.classList.add('editing-single-note');
                const titleInput = noteItem.querySelector('.edit-title-input-note');
                const contentTextarea = noteItem.querySelector('.edit-note-textarea');
                titleInput.value = notes[index].title;
                contentTextarea.value = notes[index].content;
                titleInput.focus();
            }
        }

        function saveEditedNote(index) {
            const noteItem = document.querySelector(`.note-item[data-index="${index}"]`);
            if (noteItem) {
                const newTitle = noteItem.querySelector('.edit-title-input-note').value.trim();
                const newContent = noteItem.querySelector('.edit-note-textarea').value.trim();
                if (newTitle && newContent) {
                    notes[index].title = newTitle;
                    notes[index].content = newContent;
                    saveNotes();
                    noteItem.classList.remove('editing-single-note');
                    displayNotes(currentNotePage);
                } else {
                    alert('Naslov i sadržaj bilješke ne mogu biti prazni.');
                }
            }
        }

        function cancelEditNote(index) {
            const noteItem = document.querySelector(`.note-item[data-index="${index}"]`);
            if (noteItem) {
                noteItem.classList.remove('editing-single-note');
                displayNotes(currentNotePage);
            }
        }

        function deleteNote(index) {
            if (confirm('Jeste li sigurni da želite obrisati ovu bilješku?')) {
                notes.splice(index, 1);
                saveNotes();
                // Ako smo obrisali zadnju bilješku na stranici, prebaci na prethodnu
                if (currentNotePage > 1 && notes.slice((currentNotePage - 1) * notesPerPage, currentNotePage * notesPerPage).length === 0) {
                    currentNotePage--;
                }
                displayNotes(currentNotePage);
            }
        }

        function clearAllNotes() {
            if (confirm('Jeste li sigurni da želite trajno obrisati SVE bilješke? Ova radnja se ne može poništiti!')) {
                notes = [];
                saveNotes();
                currentNotePage = 1; // Resetuj na prvu stranicu
                displayNotes(currentNotePage);
                alert('Sve bilješke su obrisane.');
            }
        }

        function exportNotes() {
            if (notes.length === 0) {
                alert('Nema bilješki za izvoz.');
                return;
            }
            const dataStr = JSON.stringify(notes, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'mojebiljeske.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            alert('Bilješke uspješno izvezene!');
            // Zabilježi datum backupa
            localStorage.setItem('lastBackupDate', new Date().toISOString());
            displayBackupReminder(); // Ažuriraj podsjetnik nakon backupa
        }

        function importNotes(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if (!Array.isArray(importedData) || !importedData.every(item => item.title && item.content)) {
                        alert('Datoteka nije ispravan format za bilješke.');
                        return;
                    }

                    const confirmImport = confirm('Želite li zamijeniti sve postojeće bilješke ili dodati nove bilješke postojećima?\n\nOK za ZAMJENU SVIH; Odustani za DODAVANJE NOVIH.');
                    if (confirmImport) {
                        notes = importedData;
                        alert('Bilješke uspješno zamijenjene!');
                    } else {
                        notes = notes.concat(importedData);
                        alert('Bilješke uspješno dodane!');
                    }
                    saveNotes();
                    currentNotePage = 1; // Vrati na prvu stranicu nakon uvoza
                    displayNotes(currentNotePage);
                } catch (error) {
                    alert('Greška prilikom uvoza bilješki: ' + error.message);
                }
            };
            reader.readAsText(file);
            event.target.value = ''; // Resetiraj input file element
        }

        // --- FUNKCIJE ZA BACKUP PODSJETNIK ---
        function displayBackupReminder() {
            const backupReminderDiv = document.getElementById('backupReminder');
            const lastBackupDateString = localStorage.getItem('lastBackupDate');
            let message = '';
            let showReminder = false;

            if (lastBackupDateString) {
                const lastBackupDate = new Date(lastBackupDateString);
                const today = new Date();

                // Postavi vrijeme na 00:00:00 za preciznije izračune dana
                lastBackupDate.setHours(0, 0, 0, 0);
                today.setHours(0, 0, 0, 0);

                const diffTime = today.getTime() - lastBackupDate.getTime();
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24)); // Broj punih dana

                if (diffDays >= 7) {
                    message = `Prošlo je **${diffDays} dana** od zadnjeg backupa! <span style="color: red;">**NAPRAVI BACKUP**</span> svojih linkova i bilješki!`;
                    showReminder = true;
                }
            } else {
                // Ako nikad nije napravljen backup
                message = `Dobrodošli! Preporučuje se redoviti backup. <span style="color: red;">**NAPRAVI PRVI BACKUP**</span> svojih linkova i bilješki!`;
                showReminder = true;
            }

            if (showReminder) {
                backupReminderDiv.className = 'backup-reminder'; // Dodaj stil
                backupReminderDiv.innerHTML = `
                    <span>${message}</span>
                    <button class="backup-button" onclick="initiateCombinedBackup()">Napravi Backup Sada</button>
                    <button class="backup-button" style="background-color: #6c757d;" onclick="hideBackupReminder()">Razumijem</button>
                `;
                backupReminderDiv.style.display = 'flex'; // Prikaži ga
            } else {
                backupReminderDiv.style.display = 'none'; // Sakrij ga ako nije potreban
            }
        }

        function hideBackupReminder() {
            document.getElementById('backupReminder').style.display = 'none';
        }

        // Funkcija za kombinirani backup (izvozi linkove I bilješke)
        function initiateCombinedBackup() {
            exportLinks(); // Ovo će pozvati alert i postaviti lastBackupDate
            exportNotes(); // Ovo će pozvati alert i opet postaviti lastBackupDate (što je ok, jer želimo datum zadnjeg bilo kojeg backupa)
            // Možeš dodati i jedan zajednički alert na kraju ako želiš
            alert('Backup linkova i bilješki je završen!');
            hideBackupReminder(); // Sakrij podsjetnik nakon što korisnik napravi backup
        }


        // --- INICIJALIZACIJA APLIKACIJE ---
        document.addEventListener('DOMContentLoaded', () => {
            loadLinks();
            loadNotes();
            displayBackupReminder(); // Prikaži podsjetnik pri učitavanju
        });
    </script>
</body>
</html>
